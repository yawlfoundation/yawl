<?xml version="1.0"?>
<!-- 
	I was going to add NSIS and Launch4J targets to these but....
	
	1. we're probably going to ditch NSIS eventually
	2. both need pathing to the external installations of those utilities
	   which isnt going to be very portable - or we'd have to embed them
	   into the project which is even less desireable.
-->
<project name="Experimental Editor Build file" default="build-editor" basedir="..">

	<property name="classes" value="classes"/>
    <path id="source.dirs">
		<pathelement location="editor"/>
		<pathelement location="services"/>
	</path>
    <path id="classes.dir" location="${classes}"/>

	<target name="clean">
		<echo>Cleaning...</echo>
		<delete dir="${classes}"/>
	</target>

	<target name="getEngineJar">
		<ant antfile="build/build.engine.xml"/>
		<copy todir="build/nexusWorkflowEditor/lib/" file="yawlEngine/lib/yawlEngine.jar"/>
	</target>
	<target name="compile" depends="getEngineJar, clean">
		<echo>Compiling Nexus Editor...</echo>
		<mkdir dir="${classes}"/>
		<javac debug="true" destdir="${classes}">
			<src>
				<path refid="source.dirs"/>
			</src>
			<classpath>
				<fileset dir="build/nexusWorkflowEditor/lib/" includes="*.jar"/>
				<fileset dir="build/3rdParty/serviceLibs/" includes="**/*.jar"/>
				<fileset dir="build/3rdParty/lib/">
					<include name="jms-1.1.jar"/>
					<include name="openjms*.jar"/>
				</fileset>
			</classpath>
		</javac>
		<copy todir="${classes}">
			<fileset dir="editor">
			    <exclude name="**/*.java"/>
			    <exclude name="**/editor.properties"/>
			</fileset>
		</copy>
	</target>


	<target name="build-editor" depends="compile">
		<jar destfile="build/nexusWorkflowEditor/lib/NexusEditor.jar"
        	manifest="build/nexusWorkflowEditor/setup/MANIFEST.MF">
			<fileset dir="classes">
				<include name="**/*"/>
			</fileset>
		</jar>
	</target>

	<target name="run-editor">
		<java classname="com.nexusbpm.editor.WorkflowEditor" fork="true" dir="build/nexusWorkflowEditor">
			<classpath>
				<fileset dir="build/nexusWorkflowEditor/lib/" includes="**/*.jar"/>
				<pathelement location="build/nexusWorkflowEditor/properties"/>
			</classpath>
		</java>
	</target>


</project>