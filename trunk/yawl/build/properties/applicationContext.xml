<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<beans>

    <bean id="dataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource">
         <property name="driverClassName" value="org.postgresql.Driver" />
         <property name="url" value="jdbc:postgresql:yawl" />
         <property name="username" value="postgres" />
         <property name="password" value="admin" />
    </bean>

<bean id="sessionFactory" class="org.springframework.orm.hibernate3.annotation.AnnotationSessionFactoryBean">
        <property name="dataSource" ref="dataSource" />
        <property name="hibernateProperties">
            <props>
                <prop key="hibernate.dialect">org.hibernate.dialect.PostgreSQLDialect</prop>
                <prop key="hibernate.hbm2ddl.auto">update</prop>
                <prop key="hibernate.current_session_context_class">thread</prop>
                <prop key="hibernate.transaction.factory_class">org.hibernate.transaction.JDBCTransactionFactory</prop>                 
            </props>
        </property>
        <property name="annotatedClasses">
            <list>
                <value>au.edu.qut.yawl.engine.YNetRunner</value>
                <value>au.edu.qut.yawl.elements.YNet</value>
                <value>au.edu.qut.yawl.engine.domain.YWorkItem</value>
                <value>au.edu.qut.yawl.engine.domain.YWorkItemID</value>
                <value>au.edu.qut.yawl.elements.state.YIdentifier</value>
                <value>au.edu.qut.yawl.elements.state.IdentifierSequence</value>
                <value>au.edu.qut.yawl.elements.YInputCondition</value>
                <value>au.edu.qut.yawl.elements.YOutputCondition</value>
                <value>au.edu.qut.yawl.elements.YCompositeTask</value>
                <value>au.edu.qut.yawl.elements.YAtomicTask</value>
                <value>au.edu.qut.yawl.elements.YTask</value>
                <value>au.edu.qut.yawl.elements.YCondition</value>
                <value>au.edu.qut.yawl.elements.YExternalNetElement</value>
                <value>au.edu.qut.yawl.elements.YSpecification</value>
                <value>au.edu.qut.yawl.elements.SpecVersion</value>
                <value>au.edu.qut.yawl.elements.YDecomposition</value>
                <value>au.edu.qut.yawl.elements.YFlow</value>
                <value>au.edu.qut.yawl.elements.YDecomposition</value>
                <value>au.edu.qut.yawl.elements.YMultiInstanceAttributes</value>
                <value>au.edu.qut.yawl.elements.YAWLServiceReference</value>
                <value>au.edu.qut.yawl.elements.YAWLServiceGateway</value>
                <value>au.edu.qut.yawl.engine.domain.YCaseData</value>
                <value>au.edu.qut.yawl.elements.data.YVariable</value>
                <value>au.edu.qut.yawl.elements.data.YParameter</value>
                <value>au.edu.qut.yawl.elements.YMetaData</value>
                <value>au.edu.qut.yawl.elements.KeyValue</value>
		<value>au.edu.qut.yawl.elements.state.YInternalCondition</value>
		<value>au.edu.qut.yawl.events.Event</value>
		<value>au.edu.qut.yawl.events.YWorkItemEvent</value>
		<value>au.edu.qut.yawl.events.YCaseEvent</value>
		<value>au.edu.qut.yawl.events.YDataEvent</value>
		<value>au.edu.qut.yawl.events.YErrorEvent</value>
		<value>au.edu.qut.yawl.util.MultiInstanceDataList</value>
		<value>au.edu.qut.yawl.util.MultiInstanceData</value>
		<value>au.edu.qut.yawl.exceptions.Problem</value>
		<value>au.edu.qut.yawl.admintool.model.HumanResource</value>
            </list>
        </property>
</bean>

<!-- 
 This bean identifies which methods in the engine will be transactional 
 It should cover all methods which modify engine state, but exclude any
 read-only operations   
-->
<bean id="YAWLInterceptionAdvice" 
    class="org.springframework.aop.support.RegexpMethodPointcutAdvisor">
    <property name="advice">
        <ref local="YAWLTransactionAdvice"/>
    </property>
    <property name="patterns">
        <list>
            <value>.*create.*</value>
            <value>.*cancel.*</value>
            <value>.*launch.*</value>
            <value>.*start.*</value>
            <value>.*complete.*</value>
            <value>.*add.*</value>
            <value>.*unload.*</value>
            <value>.*remove.*</value>
            <value>.*suspend.*</value>
            <value>.*unsuspend.*</value>
            <value>.*rollback.*</value>
            <value>.*update.*</value>
	    <value>.*init.*</value>
        </list>
    </property>
</bean>


<bean id="EngineInterceptor2" 
    class="org.springframework.aop.framework.ProxyFactoryBean">
    <property name="proxyInterfaces"><value>au.edu.qut.yawl.engine.YEngineInterface</value></property>
    <property name="target"><ref local="EngineBean"/></property>
    <property name="interceptorNames">
        <list>
            <value>YAWLInterceptionAdvice</value>
        </list>
    </property>
</bean>

<bean id="YAWLTransactionAdvice" class="au.edu.qut.yawl.persistence.YAWLTransactionAdvice">
    <property name="sessionFactory"><ref local="sessionFactory"/></property>
</bean>

<bean id="EngineBean" class="au.edu.qut.yawl.engine.YEngine">
</bean>

<bean id="EventLogger" class="au.edu.qut.yawl.events.YawlEventLogger">
    <property name="dispatchers">
        <list>
            <ref bean="HibernateEventDispatcher"/>
            <ref bean="JMSEventDispatcher"/>
        </list>
    </property>
</bean>
<bean id="HibernateEventDispatcher" class="au.edu.qut.yawl.events.HibernateEventDispatcher">
</bean>
<bean id="JMSEventDispatcher" class="au.edu.qut.yawl.events.JMSEventDispatcher">
</bean>



<!--

<bean id="SpecSpringDAO" class="au.edu.qut.yawl.persistence.dao.SpecificationSpringDAO">
 <property name="sessionFactory"><ref local="sessionFactory"/></property>
</bean>
<bean id="RunnerSpringDAO" class="au.edu.qut.yawl.persistence.dao.NetRunnerSpringDAO">
 <property name="sessionFactory"><ref local="sessionFactory"/></property>
</bean>
<bean id="ProblemSpringDAO" class="au.edu.qut.yawl.persistence.dao.ProblemSpringDAO">
 <property name="sessionFactory"><ref local="sessionFactory"/></property>
</bean>
<bean id="WorkItemSpringDAO" class="au.edu.qut.yawl.persistence.dao.WorkItemSpringDAO">
 <property name="sessionFactory"><ref local="sessionFactory"/></property>
</bean>
<bean id="IdentifierSpringDAO" class="au.edu.qut.yawl.persistence.dao.IdentifierSpringDAO">
 <property name="sessionFactory"><ref local="sessionFactory"/></property>
</bean>
<bean id="ServiceRefSpringDAO" class="au.edu.qut.yawl.persistence.dao.YAWLServiceReferenceSpringDAO">
 <property name="sessionFactory"><ref local="sessionFactory"/></property>
</bean>

<bean id="MyTransactionManager" class="org.springframework.orm.hibernate3.HibernateTransactionManager">
 <property name="sessionFactory"><ref local="sessionFactory"/></property>
</bean>


<bean id="EngineInterceptor" class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
   <property name="transactionManager"><ref bean="MyTransactionManager"/></property>
   <property name="target" ref="EngineBean"></property>
   <property name="transactionAttributes">
      <props>
         <prop key="*">PROPAGATION_REQUIRED, -YPersistenceException </prop>
      </props>
   </property>
</bean>
-->



</beans>