<?xml version="1.0" encoding="UTF-8"?>
<html
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:chiba="http://chiba.sourceforge.net/xforms"
    xmlns:xforms="http://www.w3.org/2002/xforms"
    xmlns:xsd="http://www.w3.org/2001/XMLSchema"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <head>
        <title>Test Repeats</title>
        <!-- nonsense example as syntax showcase for 'conditional user-agent stylesheet switching'
        (these are the default stylesheets anyway if nothing is put here)-->

        <xforms:model>
            <xforms:submission id="debug" action="../jsp/generate-instance.jsp" method="post"
                replace="instance"/>
            <xforms:instance xmlns="" id="default">
                <data>
                    <input>false</input>
                    <input>true</input>
                    <input>false</input>
                    <input>false</input>
                    <input>true</input>
                    <boolean>
                        <input>false</input>
                        <input>true</input>
                        <input>true</input>
                        <input>false</input>
                        <input>true</input>
                    </boolean>
                    <string>
                        <input>Hallo</input>
                        <input>Welt</input>
                        <input></input>
                    </string>
                </data>
            </xforms:instance>

            <xforms:bind id="b1" nodeset="input[1]" type="boolean" readonly="../input[3][.='true']" constraint="boolean(.='true')"/>
            <xforms:bind id="b2" nodeset="input[2]" type="boolean" readonly="true()" constraint="boolean(.='true')"/>
            <xforms:bind id="b3" nodeset="input[3]" type="boolean" readonly="false()" constraint="boolean(.='true')"/>
            <xforms:bind id="b4" nodeset="input[4]" type="boolean" readonly="false()" constraint="boolean(.='true')"/>
            <!-- open issue: relevant facet use string comparison instead of Schema type comparison as defined by referenced bind -->
            <xforms:bind id="b5" nodeset="input[5]" type="boolean" relevant="../input[4][.='true']"/>

            <xforms:bind id="repeatBoolean" nodeset="boolean/input[position() != last()]">
                <xforms:bind id="entryBoolean" nodeset="." type="boolean" constraint="boolean(.='true')"/>
            </xforms:bind>

            <xforms:bind id="repeatString" nodeset="string/input[position() != last()]">
                <xforms:bind id="entryString" nodeset="." type="string" constraint="string-length(.) &gt; 0"/>
            </xforms:bind>

            <xforms:submission id="save" action="../jsp/debug-instance.jsp" method="post"
                replace="all"/>

        </xforms:model>
    </head>
    <body>
        <xforms:group appearance="full">
            <xforms:label>Boolean Tests</xforms:label>

            <xforms:group>
                <xforms:label>Boolean control states</xforms:label>
                <xforms:input bind="b1">
                    <xforms:label>1: readonly/unchecked</xforms:label>
                    <xforms:alert>must be true</xforms:alert>
                </xforms:input>
                <xforms:input bind="b2">
                    <xforms:label>2: readonly/checked</xforms:label>
                    <xforms:alert>must be true</xforms:alert>
                </xforms:input>
                <xforms:input bind="b3" incremental="false">
                    <xforms:label>3: readwrite/checked</xforms:label>
                    <xforms:alert>must be true to make 1: readonly</xforms:alert>
                </xforms:input>
                <xforms:input bind="b4">
                    <xforms:label>4: readwrite/checked</xforms:label>
                    <xforms:alert>must be true to make 5: relevant</xforms:alert>
                </xforms:input>
                <xforms:input bind="b5">
                    <xforms:label>5: enabled/disabled dependent on above control</xforms:label>
                    <xforms:alert>must be true</xforms:alert>
                </xforms:input>
            </xforms:group>

            <xforms:group appearance="full">
                <xforms:label>Repeat: Input Type = boolean</xforms:label>
                <xforms:trigger>
                    <xforms:label>Append</xforms:label>
                    <xforms:hint>appends a new entry at the end of this collection</xforms:hint>
                    <xforms:action>
                        <xforms:insert nodeset="boolean/input"
                            xforms:at="last()=1" position="after"/>
                    </xforms:action>
                </xforms:trigger>
                <xforms:trigger>
                    <xforms:label>Delete selected</xforms:label>
                    <xforms:hint>deletes selected entry from this collection</xforms:hint>
                    <xforms:action>
                        <xforms:delete bind="repeatBoolean" at="xforms:index('repeatBooleanID')"/>
                    </xforms:action>
                </xforms:trigger>
                <xforms:repeat id="repeatBooleanID" bind="repeatBoolean" appearance="full">
                    <xforms:input bind="entryBoolean">
                        <xforms:label>repeated input:</xforms:label>
                        <xforms:hint>repeated enty</xforms:hint>
                        <xforms:alert>must be true</xforms:alert>
                    </xforms:input>
                </xforms:repeat>
            </xforms:group>

            Normal string input for comparison
            <xforms:group appearance="full">
                <xforms:label>Repeat: Input Type = string</xforms:label>
                <xforms:trigger>
                    <xforms:label>Append</xforms:label>
                    <xforms:hint>appends a new entry at the end of this collection</xforms:hint>
                    <xforms:action>
                        <xforms:insert nodeset="string/input"
                            xforms:at="last()=1" position="after"/>
                    </xforms:action>
                </xforms:trigger>
                <xforms:trigger>
                    <xforms:label>Delete selected</xforms:label>
                    <xforms:hint>deletes selected entry from this collection</xforms:hint>
                    <xforms:action>
                        <xforms:delete bind="repeatString" at="xforms:index('repeatStringID')"/>
                    </xforms:action>
                </xforms:trigger>
                <xforms:repeat id="repeatStringID" bind="repeatString" appearance="full">
                    <xforms:input bind="entryString">
                        <xforms:label>repeated input:</xforms:label>
                        <xforms:hint>repeated enty</xforms:hint>
                        <xforms:alert>must be non-empty string</xforms:alert>
                    </xforms:input>
                </xforms:repeat>
            </xforms:group>

            <xforms:trigger>
                <xforms:label>debug</xforms:label>
                <xforms:send submission="save"/>
            </xforms:trigger>
        </xforms:group>
    </body>
</html>