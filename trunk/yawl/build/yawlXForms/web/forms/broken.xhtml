<?xml version="1.0" encoding="ISO-8859-1"?>
<html xmlns="http://www.w3.org/2002/06/xhtml2/"
    xmlns:xforms="http://www.w3.org/2002/xforms"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:ev="http://www.w3.org/2001/xml-events"    
    xmlns:xsd="http://www.w3.org/2001/XMLSchema">
    <head>
        <title>Testing</title>
        <xforms:model>
            <xforms:action ev:event="xforms-model-construct-done">
            	<!-- Comment this delete out to get rid of the null pointer exception 
            	     But it is needed to remove the last element in the node set, which I add
            	     to initialise the empty repeat element for insertion
            	     
            	     If you comment it out, and try delete the last element in the 
            	     repeat, there is an ArrayIndexOutOfBoundsException
            	-->
            	<xforms:delete bind="editable" at="last()" />
            </xforms:action>
            
            
            <xforms:submission id="debug" action="../jsp/debug-instance.jsp" method="post" replace="all"/>
            <xforms:instance id="maininstance">
                <data xmlns="">
                    <item mutable="1" name="Test 1" />
                    <item mutable="1" name="Test 2" />
                    <item mutable="1" name="Test 3" />
                    <item mutable="0" name="Fixed 1" />
                    <item mutable="0" name="Fixed 2" />
                    <item mutable="0" name="Fixed 3" />
                    <item mutable="1" name="" />
                    <selected/>
                </data>
            </xforms:instance>
            <xforms:bind id="editable" nodeset="//item[@mutable='1']"/>
            <xforms:bind id="all" nodeset="//item"/>
            <xforms:bind id="bind-selected" nodeset="//selected"/>
        </xforms:model>
    </head>
    <body>
        <xforms:group appearance="minimal">
            <xforms:label>Inputs</xforms:label>
            <xforms:repeat id="repeat-1" bind="editable">
            	<xforms:input ref="@name" />
            </xforms:repeat>
            <xforms:trigger>
            	<xforms:label>Add</xforms:label>
            	<xforms:action>
            		<xforms:insert bind="editable" at="index('repeat-1')" position="after"/>
            	</xforms:action>
            </xforms:trigger>
            <xforms:trigger>
            	<xforms:label>Del</xforms:label>
            	<xforms:action>
            		<xforms:delete bind="editable" at="index('repeat-1')"/>
            	</xforms:action>
            </xforms:trigger>
         </xforms:group>
         <xforms:group appearance="minimal">
         	<xforms:label>Select1</xforms:label>
         	<xforms:select1 bind="bind-selected">
         		<xforms:itemset bind="all">
         			<xforms:label ref="@name" />
         			<xforms:value ref="@name" />
         		</xforms:itemset>
         	</xforms:select1>
         </xforms:group>
            
            <xforms:group appearance="minimal">
                <xforms:trigger>
                    <xforms:label id="C-11">Debug</xforms:label>
                    <xforms:action id="C-12">
                        <xforms:send submission="debug"/>
                    </xforms:action>
                </xforms:trigger>
                <xforms:trigger id="reset-btn">
                    <xforms:label id="C-11">Reset</xforms:label>
                    <xforms:action id="C-12">
                        <xforms:reset id="reset"/>
                    </xforms:action>
                </xforms:trigger>
            </xforms:group>
    </body>
</html>
