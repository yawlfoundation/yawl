<?xml version="1.0" encoding="UTF-8"?>
<!--+ Example application for a Chiba Web  XForms ToDoList
    + @version 0.01
    + @date    26.04.2006
    + @author Lars Windauer
    + @licence OSI-approved Artistic License 
    + @liceceURL: http://opensource.org/licenses/artistic-license.php
    + @knownBugs To many so far ;o)
    +-->
<html
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:chiba="http://chiba.sourceforge.net/xforms"
        xmlns:ev="http://www.w3.org/2001/xml-events"
        xmlns:xf="http://www.w3.org/2002/xforms"
        xmlns:xsd="http://www.w3.org/2001/XMLSchema"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
<head>
    <title>Chiba Issuetracking</title>
    <xf:model>
        <!-- Instance Datas of the 2DoList -->
        <!-- xf:instance src="data/toDoList.xml"/-->
        <xf:instance id="issues" src="data/issueTracking/issues.xml"/>
        <xf:instance id="categories" src="data/issueTracking/categories.xml"/>
        <xf:instance id="projects" src="data/issueTracking/projects.xml"/>
        <xf:instance id="users" src="data/issueTracking/users.xml"/>
        <xf:instance id="controller" xmlns="">
            <controller>
                <issue id="0" summary="" type="" status="" priority="" severity="" date="" creator="" project="">
                    <annotation/>
                </issue>
                <change summary="false" type="false" annotation="false" status="false" priority="false" severity="false"
                        project="false" any="false"/>
                <save-button/>
                <copy/>
            </controller>
        </xf:instance>

        <xf:bind nodeset="instance('controller')">
            <xf:bind id="controllerIssue" nodeset="issue[1]">
                <xf:bind id="conID"       nodeset="@id"/>
                <xf:bind id="conSummary"  nodeset="@summary"/>
                <xf:bind id="conType"     nodeset="@type"/>
                <xf:bind id="conStatus"   nodeset="@status"/>
                <xf:bind id="conPriority" nodeset="@priority"/>
                <xf:bind id="conSeverity" nodeset="@severity"/>
                <xf:bind id="conDate"     nodeset="@date"/>
                <xf:bind id="conCreator"  nodeset="@creator"/>
                <xf:bind id="conProject"  nodeset="@project"/>
                <xf:bind id="conAnnotation" nodeset="annotation" required="true()"/>
            </xf:bind>
            <xf:bind nodeset="change">
                <xf:bind id="chngSummary" nodeset="@summary"/>
                <xf:bind id="chngType" nodeset="@type"/>
                <xf:bind id="chngStatus" nodeset="@status"/>
                <xf:bind id="chngPriority" nodeset="@priority"/>
                <xf:bind id="chngSeverity" nodeset="@severity"/>
                <xf:bind id="chngProject" nodeset="@project"/>
                <xf:bind id="chngAnnotation" nodeset="@annotation"/>
                <xf:bind nodeset="@any" calculate="
                    boolean-from-string(../@summary) or
                    boolean-from-string(../@type) or
                    boolean-from-string(../@status) or
                    boolean-from-string(../@priority) or
                    boolean-from-string(../@severity) or
                    boolean-from-string(../@project) or
                    boolean-from-string(../@annotation)"/>
            </xf:bind>
            <xf:bind id="save-button" nodeset="save-button"
                     readonly="string-length(normalize-space(../issue/annotation))=0"/>
            <xf:bind nodeset="copy" readonly="count(instance('issues')/issue)=1"/>
        </xf:bind>



        <xf:bind id="issueList" nodeset="instance('issues')/issue[position()!=last()]">
            <xf:bind id="issueID" nodeset="@id"/>
            <xf:bind id="userNick" nodeset="@creator" readonly="true()"/>
        </xf:bind>
        <xf:bind id="selectedIssueDetails" nodeset="instance('issues')/issue[index('iList')]">
            <xf:bind id="iIssueID" nodeset="@id"/>
            <xf:bind id="iSummary" nodeset="@summary"/>
            <xf:bind id="iType" nodeset="@type"/>
            <xf:bind id="iStatus" nodeset="@status"/>
            <xf:bind id="iPriority" nodeset="@priority"/>
            <xf:bind id="iSeverity" nodeset="@severity"/>
            <xf:bind id="iDate" nodeset="@date" type="dateTime"/>
            <xf:bind id="iProject" nodeset="@project"/>
            <xf:bind id="iDesc" nodeset="issueDesc"/>
            <xf:bind id="iChangeLog" nodeset="changelog/change"/>
        </xf:bind>

        <xf:submission id="debug" method="post" action="../jsp/debug-instance.jsp"/>
        <xf:action ev:event="xforms-link-exception">
            <xf:message>Instance loading failed.</xf:message>
        </xf:action>
    </xf:model>
</head>

<body>
<xf:group appearance="full">
<xf:label><b>Chiba XForms Issuetracking</b></xf:label>

<!-- Group: Issues: Issue Overview -->
<xf:switch>
<xf:case id="c-default">
    <xf:group appearance="full">
        <xf:label>Issue List</xf:label>
        <xf:repeat id="iList" bind="issueList" appearance="compact">
            <xf:output ref="@id">
                <xf:label>ID</xf:label>
            </xf:output>
            <xf:output ref="@summary">
                <xf:label>Summary</xf:label>
            </xf:output>

            <xf:select1 bind="userNick" appearance="minimal">
                <xf:label>Creator</xf:label>
                <xf:itemset nodeset="instance('users')/user">
                    <xf:label ref="nick"/>
                    <xf:value ref="@id"/>
                </xf:itemset>
            </xf:select1>
            <xf:output value="substring-before(@date, 'T')">
              <xf:label>Date</xf:label>
            </xf:output>
             <xf:output value="substring-before((substring-after(@date, 'T')), '+')">
              <xf:label>Time</xf:label>
            </xf:output>
            <xf:output ref="issueDesc">
                <xf:label>Description</xf:label>
            </xf:output>
        </xf:repeat>
    </xf:group>
    <xf:group appearance="minimal">
        <xf:trigger bind="controllerIssue">
            <xf:label>Create Issue</xf:label>
            <xf:action>
                <xf:setvalue ref="@id" value="format-number(max(instance('issues')/issue/@id) + 1, '0')"/>
                <xf:setvalue ref="@date" value="now()"/>
                <xf:setvalue ref="@creator"/>
                <xf:setvalue ref="@summary"/>
                <xf:setvalue ref="@type"/>
                <xf:setvalue ref="@status"/>
                <xf:setvalue ref="@priority"/>
                <xf:setvalue ref="@severity"/>
                <xf:setvalue ref="@project"/>
                <xf:setvalue ref="annotation"/>
                <xf:toggle case="c-create"/>
            </xf:action>
        </xf:trigger>
        <xf:trigger ref="instance('controller')/copy">
            <xf:label>Edit selected Issue</xf:label>
            <xf:action>
               <xf:setvalue bind="chngSummary" value="'false'"/>
                <xf:setvalue bind="chngType" value="'false'"/>
                <xf:setvalue bind="chngStatus" value="'false'"/>
                <xf:setvalue bind="chngPriority" value="'false'"/>
                <xf:setvalue bind="chngSeverity" value="'false'"/>
                <xf:setvalue bind="chngProject" value="'false'"/>
                <xf:setvalue bind="chngAnnotation" value="'false'"/>

                <xf:setvalue bind="conID" value="instance('issues')/issue[index('iList')]/@id"/>
                <xf:setvalue bind="conDate" value="instance('issues')/issue[index('iList')]/@date"/>
                <xf:setvalue bind="conCreator" value="instance('issues')/issue[index('iList')]/@creator"/>
                <xf:setvalue bind="conSummary" value="instance('issues')/issue[index('iList')]/@summary"/>
                <xf:setvalue bind="conType" value="instance('issues')/issue[index('iList')]/@type"/>
                <xf:setvalue bind="conStatus" value="instance('issues')/issue[index('iList')]/@status"/>
                <xf:setvalue bind="conPriority" value="instance('issues')/issue[index('iList')]/@priority"/>
                <xf:setvalue bind="conSeverity" value="instance('issues')/issue[index('iList')]/@severity"/>
                <xf:setvalue bind="conProject" value="instance('issues')/issue[index('iList')]/@project"/>
                <xf:setvalue bind="conAnnotation"/>
                <xf:toggle case="c-edit"/>
            </xf:action>
        </xf:trigger>
        <xf:trigger ref="instance('controller')/copy">
            <xf:label>Delete selected Issue</xf:label>
            <xf:action>
                <xf:toggle case="c-delete"/>
            </xf:action>
        </xf:trigger>
    </xf:group>
</xf:case>
<xf:case id="c-create">
<xf:group appearance="full" bind="controllerIssue">
    <xf:label>Create Issue #<xf:output ref="@id"/></xf:label>

    <xf:select1 ref="@type" appearance="minimal">
        <xf:label>Type</xf:label>
        <xf:itemset nodeset="instance('categories')/itypes/type">
            <xf:label ref="."/>
            <xf:value ref="@id"/>
        </xf:itemset>
    </xf:select1>

    <xf:input ref="@summary">
        <xf:label>Summary</xf:label>
    </xf:input>


    <xf:select1 ref="@project" appearance="minimal">
        <xf:label>Project</xf:label>
        <xf:itemset nodeset="instance('projects')/project">
            <xf:label ref="name"/>
            <xf:value ref="@id"/>
        </xf:itemset>
    </xf:select1>

    <xf:textarea ref="annotation">
        <xf:label>Description</xf:label>
    </xf:textarea>

    <xf:select1 ref="@priority" appearance="minimal">
        <xf:label>Priority</xf:label>
        <xf:itemset nodeset="instance('categories')/ipriorities/priority">
            <xf:label ref="."/>
            <xf:value ref="@id"/>
        </xf:itemset>
    </xf:select1>

    <xf:select1 ref="@severity" appearance="minimal">
        <xf:label>Severity</xf:label>
        <xf:itemset nodeset="instance('categories')/iseverities/severity">
            <xf:label ref="."/>
            <xf:value ref="@id"/>
        </xf:itemset>
    </xf:select1>

    <xf:select1 ref="@status" appearance="minimal">
        <xf:label>Status</xf:label>
        <xf:itemset nodeset="instance('categories')/istatus/status">
            <xf:label ref="."/>
            <xf:value ref="@id"/>
        </xf:itemset>
    </xf:select1>

</xf:group>
<xf:group appearance="minimal">
    <xf:trigger>
        <xf:label>Create</xf:label>
        <xf:action>
            <xf:setindex repeat="changeLogList" index="1"/>
            <xf:rebuild/>
            <xf:insert nodeset="instance('issues')/issue" at="last()" position="before"/>
            <xf:setvalue ref="instance('issues')/issue[index('iList')]/@id"
                         value="instance('controller')/issue[1]/@id"/>
            <xf:setvalue ref="instance('issues')/issue[index('iList')]/@date"
                         value="instance('controller')/issue[1]/@date"/>
            <!-- TODO: Author = logged in User, (for the moment static identifier) -->
            <xf:setvalue ref="instance('issues')/issue[index('iList')]/@creator" value="'2'"/>
            <xf:setvalue ref="instance('issues')/issue[index('iList')]/@type"
                         value="instance('controller')/issue[1]/@type"/>
            <xf:setvalue ref="instance('issues')/issue[index('iList')]/@summary"
                         value="instance('controller')/issue[1]/@summary"/>
            <xf:setvalue ref="instance('issues')/issue[index('iList')]/@status"
                         value="instance('controller')/issue[1]/@status"/>
            <xf:setvalue ref="instance('issues')/issue[index('iList')]/@priority"
                         value="instance('controller')/issue[1]/@priority"/>
            <xf:setvalue ref="instance('issues')/issue[index('iList')]/@severity"
                         value="instance('controller')/issue[1]/@severity"/>
            <xf:setvalue ref="instance('issues')/issue[index('iList')]/@project"
                         value="instance('controller')/issue[1]/@project"/>
            <xf:setvalue ref="instance('issues')/issue[index('iList')]/issueDesc"
                         value="instance('controller')/issue[1]/annotation"/>
            <!-- Write the first change to the issue changelog and initialize it with the values from creation -->
            <xf:setvalue ref="instance('issues')/issue[index('iList')]/changelog/change[1]/@date"
                         value="instance('controller')/issue[1]/@date"/>
            <xf:setvalue ref="instance('issues')/issue[index('iList')]/changelog/change[1]/@author" value="'2'"/>
            <xf:setvalue ref="instance('issues')/issue[index('iList')]/changelog/change[1]/summary"
                         value="instance('controller')/issue[1]/@summary"/>
            <xf:setvalue ref="instance('issues')/issue[index('iList')]/changelog/change[1]/type"
                         value="instance('controller')/issue[1]/@type"/>
            <xf:setvalue ref="instance('issues')/issue[index('iList')]/changelog/change[1]/status"
                         value="instance('controller')/issue[1]/@status"/>
            <xf:setvalue ref="instance('issues')/issue[index('iList')]/changelog/change[1]/priority"
                         value="instance('controller')/issue[1]/@priority"/>
            <xf:setvalue ref="instance('issues')/issue[index('iList')]/changelog/change[1]/severity"
                         value="instance('controller')/issue[1]/@severity"/>
            <xf:setvalue ref="instance('issues')/issue[index('iList')]/changelog/change[1]/project"
                         value="instance('controller')/issue[1]/@project"/>
            <xf:setvalue ref="instance('issues')/issue[index('iList')]/changelog/change[1]/annotation"
                         value="'Issue created'"/>
            <xf:toggle case="c-default"/>
        </xf:action>
    </xf:trigger>
    <xf:trigger>
        <xf:label>Cancel</xf:label>
        <xf:action>
            <xf:toggle case="c-default"/>
        </xf:action>
    </xf:trigger>
</xf:group>
</xf:case>
<xf:case id="c-edit">
<!-- Group: Issues: Issue Details -->
<xf:group appearance="full" bind="selectedIssueDetails">
    <xf:label>Issue Details</xf:label>
    <xf:output ref="@id">
        <xf:label>ID</xf:label>
    </xf:output>
    <xf:select1 ref="@type" appearance="minimal">
        <xf:label>Type</xf:label>
        <xf:itemset nodeset="instance('categories')/itypes/type">
            <xf:label ref="."/>
            <xf:value ref="@id"/>
        </xf:itemset>
    </xf:select1>
    <xf:output ref="@summary">
        <xf:label>Summary</xf:label>
    </xf:output>
    <xf:select1 ref="@creator">
        <xf:label>Creator</xf:label>
        <xf:itemset nodeset="instance('users')/user">
            <xf:label ref="nick"/>
            <xf:value ref="@id"/>
        </xf:itemset>
    </xf:select1>
    <xf:output value="substring-before(@date, 'T')">
      <xf:label>Date</xf:label>
    </xf:output>
    <xf:textarea ref="issueDesc">
        <xf:label>Description</xf:label>
    </xf:textarea>
    <xf:output value="substring-before((substring-after(@date, 'T')), '+')">
        <xf:label>Time</xf:label>
    </xf:output>
    <xf:select1 ref="@project" appearance="minimal">
        <xf:label>Project</xf:label>
        <xf:itemset nodeset="instance('projects')/project">
            <xf:label ref="name"/>
            <xf:value ref="@id"/>
        </xf:itemset>
    </xf:select1>

    <xf:select1 ref="@priority" appearance="minimal">
        <xf:label>Priority</xf:label>
        <xf:itemset nodeset="instance('categories')/ipriorities/priority">
            <xf:label ref="."/>
            <xf:value ref="@id"/>
        </xf:itemset>
    </xf:select1>

    <xf:select1 ref="@severity" appearance="minimal">
        <xf:label>Severity</xf:label>
        <xf:itemset nodeset="instance('categories')/iseverities/severity">
            <xf:label ref="."/>
            <xf:value ref="@id"/>
        </xf:itemset>
    </xf:select1>
    <xf:select1 ref="@status" appearance="minimal">
        <xf:label>Status</xf:label>
        <xf:itemset nodeset="instance('categories')/istatus/status">
            <xf:label ref="."/>
            <xf:value ref="@id"/>
        </xf:itemset>
    </xf:select1>
</xf:group>

<xf:group appearance="full" ref="instance('controller')/issue">
    <xf:label>Edit Issue #<xf:output ref="@id"/></xf:label>

    <xf:select1 ref="@type" appearance="minimal">
        <xf:label>Type</xf:label>
        <xf:itemset nodeset="instance('categories')/itypes/type">
            <xf:label ref="."/>
            <xf:value ref="@id"/>
        </xf:itemset>
        <xf:action ev:event="xforms-value-changed">
            <xf:setvalue ref="instance('controller')/change/@type"
                         value="if(instance('controller')/issue/@type != instance('issues')/issue[index('iList')]/@type, true(), false())"/>
        </xf:action>
    </xf:select1>

    <xf:input ref="@summary">
        <xf:label>Summary</xf:label>
        <xf:action ev:event="xforms-value-changed">
            <xf:setvalue ref="instance('controller')/change/@summary"
                         value="if(instance('controller')/issue/@summary != instance('issues')/issue[index('iList')]/@summary, true(), false())"/>
        </xf:action>
    </xf:input>

    <xf:textarea ref="annotation">
        <xf:label>Annotation</xf:label>
        <xf:action ev:event="xforms-value-changed">
            <xf:setvalue ref="instance('controller')/change/@annotation"
                         value="if(string-length(instance('controller')/issue/annotation) &gt; 0, true(), false())"/>
        </xf:action>
    </xf:textarea>

    <xf:select1 ref="@project" appearance="minimal">
        <xf:label>Project</xf:label>
        <xf:itemset nodeset="instance('projects')/project">
            <xf:label ref="name"/>
            <xf:value ref="@id"/>
        </xf:itemset>
        <xf:action ev:event="xforms-value-changed">
            <xf:setvalue ref="instance('controller')/change/@project"
                         value="if(instance('controller')/issue/@project != instance('issues')/issue[index('iList')]/@project, true(), false())"/>
        </xf:action>
    </xf:select1>

    <xf:select1 ref="@priority" appearance="minimal">
        <xf:label>Priority</xf:label>
        <xf:itemset nodeset="instance('categories')/ipriorities/priority">
            <xf:label ref="."/>
            <xf:value ref="@id"/>
        </xf:itemset>
        <xf:action ev:event="xforms-value-changed">
            <xf:setvalue ref="instance('controller')/change/@priority"
                         value="if(instance('controller')/issue/@priority != instance('issues')/issue[index('iList')]/@priority, true(), false())"/>
        </xf:action>
    </xf:select1>

    <xf:select1 ref="@severity" appearance="minimal">
        <xf:label>Severity</xf:label>
        <xf:itemset nodeset="instance('categories')/iseverities/severity">
            <xf:label ref="."/>
            <xf:value ref="@id"/>
        </xf:itemset>
        <xf:action ev:event="xforms-value-changed">
            <xf:setvalue ref="instance('controller')/change/@severity"
                         value="if(instance('controller')/issue/@severity != instance('issues')/issue[index('iList')]/@severity, true(), false())"/>
        </xf:action>
    </xf:select1>

    <xf:select1 ref="@status" appearance="minimal">
        <xf:label>Status</xf:label>
        <xf:itemset nodeset="instance('categories')/istatus/status">
            <xf:label ref="."/>
            <xf:value ref="@id"/>
        </xf:itemset>
        <xf:action ev:event="xforms-value-changed">
            <xf:setvalue ref="instance('controller')/change/@status"
                         value="if(instance('controller')/issue/@status != instance('issues')/issue[index('iList')]/@status, true(), false())"/>
        </xf:action>
    </xf:select1>
</xf:group>
<xf:group appearance="minimal">
    <xf:trigger ref="instance('controller')/save-button">
        <xf:label>Save</xf:label>
        <xf:action>
            <!-- compute changes -->
            <xf:insert nodeset="instance('issues')/issue[index('iList')]/changelog/change" at="1" position="before"/>
            <xf:setvalue ref="instance('issues')/issue[index('iList')]/changelog/change[1]/@date" value="now()"/>
            <!-- TODO: Author = logged in User, (for the moment static identifier) -->
            <xf:setvalue ref="instance('issues')/issue[index('iList')]/changelog/change[1]/@author" value="'1'"/>
            <xf:setvalue ref="instance('issues')/issue[index('iList')]/changelog/change[1]/summary"
                         value="instance('issues')/issue[index('iList')]/@summary"/>
            <xf:setvalue ref="instance('issues')/issue[index('iList')]/changelog/change[1]/type"
                         value="instance('issues')/issue[index('iList')]/@type"/>
            <xf:setvalue ref="instance('issues')/issue[index('iList')]/changelog/change[1]/status"
                         value="instance('issues')/issue[index('iList')]/@status"/>
            <xf:setvalue ref="instance('issues')/issue[index('iList')]/changelog/change[1]/priority"
                         value="instance('issues')/issue[index('iList')]/@priority"/>
            <xf:setvalue ref="instance('issues')/issue[index('iList')]/changelog/change[1]/severity"
                         value="instance('issues')/issue[index('iList')]/@severity"/>
            <xf:setvalue ref="instance('issues')/issue[index('iList')]/changelog/change[1]/project"
                         value="instance('issues')/issue[index('iList')]/@project"/>
            <!-- Delete everything that was not(!) changed -->
            <xf:delete nodeset="instance('issues')/issue[index('iList')]/changelog/change[1]/summary"
                       at="if(boolean-from-string(instance('controller')/change/@summary), 0, 1)"/>
            <xf:delete nodeset="instance('issues')/issue[index('iList')]/changelog/change[1]/type"
                       at="if(boolean-from-string(instance('controller')/change/@type), 0, 1)"/>
            <xf:delete nodeset="instance('issues')/issue[index('iList')]/changelog/change[1]/status"
                       at="if(boolean-from-string(instance('controller')/change/@status), 0, 1)"/>
            <xf:delete nodeset="instance('issues')/issue[index('iList')]/changelog/change[1]/priority"
                       at="if(boolean-from-string(instance('controller')/change/@priority), 0, 1)"/>
            <xf:delete nodeset="instance('issues')/issue[index('iList')]/changelog/change[1]/severity"
                       at="if(boolean-from-string(instance('controller')/change/@severity), 0, 1)"/>
            <xf:delete nodeset="instance('issues')/issue[index('iList')]/changelog/change[1]/project"
                       at="if(boolean-from-string(instance('controller')/change/@project), 0, 1)"/>
            <xf:delete nodeset="instance('issues')/issue[index('iList')]/changelog/change"
                       at="if(boolean-from-string(instance('controller')/change/@any), 0, 1)"/>
            <!-- update issue -->
            <xf:setvalue ref="instance('issues')/issue[index('iList')]/@date"
                         value="instance('controller')/issue[1]/@date"/>
            <xf:setvalue ref="instance('issues')/issue[index('iList')]/@summary"
                         value="instance('controller')/issue[1]/@summary"/>
            <xf:setvalue ref="instance('issues')/issue[index('iList')]/@type"
                         value="instance('controller')/issue[1]/@type"/>
            <xf:setvalue ref="instance('issues')/issue[index('iList')]/@status"
                         value="instance('controller')/issue[1]/@status"/>
            <xf:setvalue ref="instance('issues')/issue[index('iList')]/@priority"
                         value="instance('controller')/issue[1]/@priority"/>
            <xf:setvalue ref="instance('issues')/issue[index('iList')]/@severity"
                         value="instance('controller')/issue[1]/@severity"/>
            <xf:setvalue ref="instance('issues')/issue[index('iList')]/@project"
                         value="instance('controller')/issue[1]/@project"/>
            <xf:setvalue ref="instance('issues')/issue[index('iList')]/changelog/change[1]/annotation"
                         value="instance('controller')/issue[1]/annotation"/>

            <xf:toggle case="c-default"/>
        </xf:action>
    </xf:trigger>
    <xf:trigger>
        <xf:label>Cancel</xf:label>
        <xf:action>
            <xf:toggle case="c-default"/>
        </xf:action>
    </xf:trigger>
</xf:group>
<xf:group appearance="full">
    <xf:label><i>TODO</i> Issue Changelog</xf:label>
    <!-- TODO If anyone edits a Issue and safes its changes, its not possible to create a new issue
       anymore. If you uncomment the following repeat item, everything works
    -->
    <xf:repeat id="changeLogList" bind="iChangeLog" appearance="compact">
        <xf:output value="substring-before(@date, 'T')">
            <xf:label>Date</xf:label>
        </xf:output>
        <xf:output value="substring-before((substring-after(@date, 'T')), '+')">
            <xf:label>Time</xf:label>
        </xf:output>
        <xf:select1 ref="@author">
            <xf:label>Author</xf:label>
            <xf:itemset nodeset="instance('users')/user">
                <xf:label ref="nick"/>
                <xf:value ref="@id"/>
            </xf:itemset>
        </xf:select1>
        <xf:select1 ref="type">
            <xf:label>Type</xf:label>
            <xf:itemset nodeset="instance('categories')/itypes/type">
                <xf:label ref="."/>
                <xf:value ref="@id"/>
            </xf:itemset>
        </xf:select1>
        <xf:output ref="summary">
            <xf:label>summary</xf:label>
        </xf:output>
        <xf:output ref="annotation">
            <xf:label>Annotation</xf:label>
        </xf:output>
        <xf:select1 ref="project">
            <xf:label>Project</xf:label>
            <xf:itemset nodeset="instance('projects')/project">
                <xf:label ref="name"/>
                <xf:value ref="@id"/>
            </xf:itemset>
        </xf:select1>
        <xf:select1 ref="priority">
            <xf:label>Priority</xf:label>
            <xf:itemset nodeset="instance('categories')/ipriorities/priority">
                <xf:label ref="."/>
                <xf:value ref="@id"/>
            </xf:itemset>
        </xf:select1>
        <xf:select1 ref="severity">
            <xf:label>Severity</xf:label>
            <xf:itemset nodeset="instance('categories')/iseverities/severity">
                <xf:label ref="."/>
                <xf:value ref="@id"/>
            </xf:itemset>
        </xf:select1>
        <xf:select1 ref="status">
            <xf:label>Status</xf:label>
            <xf:itemset nodeset="instance('categories')/istatus/status">
                <xf:label ref="."/>
                <xf:value ref="@id"/>
            </xf:itemset>
        </xf:select1>
    </xf:repeat>
</xf:group>
</xf:case>
<xf:case id="c-delete">
    <xf:group appearance="minimal" bind="selectedIssueDetails">
        <xf:label>Really delete Issue <xf:output ref="@id"/></xf:label>
        <xf:trigger>
            <xf:label>Delete</xf:label>
            <xf:action>
                <xf:delete nodeset="instance('issues')/issue" at="index('iList')"/>
                <xf:toggle case="c-default"/>
            </xf:action>
        </xf:trigger>
        <xf:trigger>
            <xf:label>Cancel</xf:label>
            <xf:action>
                <xf:toggle case="c-default"/>
            </xf:action>
        </xf:trigger>
    </xf:group>
</xf:case>
</xf:switch>
<!-- /Group: Issues: Issue Details -->
</xf:group>
<xf:submit submission="debug">
    <xf:label>Debug</xf:label>
</xf:submit>
<!-- Group -->
</body>
</html>
