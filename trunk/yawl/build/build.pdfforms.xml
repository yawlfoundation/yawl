<?xml version="1.0"?>
<!-- $Id: $ -->
<project name="Experimental PDFforms Build file" default="build_PDFforms.war"><!-- basedir="./.."> -->

    <property name="yawl.pdfforms.app.name" value="PDFforms"/>

	<!-- Reference the main 3rd party library directory for this component -->
    <property name="pdf.libs" value="./build/3rdParty/pdflibs"/>

	<!--
    PDF Dependencies
    -->
    <property name="itext" value="${pdf.libs}/itext-1.4.jar"/>
    <property name="bcprov" value="${pdf.libs}/bcprov-jdk14-130.jar"/>
    <property name="fileupload" value="${pdf.libs}/commons-fileupload-1.0.jar"/>

    <!--
    PDF Forms Classpath
    -->
    <path id="cp.pdfforms">
        <pathelement location="${itext}"/>
        <pathelement location="${bcprov}"/>
        <pathelement location="${fileupload}"/>
    </path>
	
    <target name="build_PDFforms.war" depends="compile">
	<!-- ======================================================================
        Prepare YAWL PDF form WebApplication
        -->
        <mkdir dir="${yawl.pdfforms.app.name}/repository/"/>
        <mkdir dir="${yawl.pdfforms.app.name}/secure/"/>
        <mkdir dir="${yawl.pdfforms.app.name}/secure/certificates/"/>
        <mkdir dir="${yawl.pdfforms.app.name}/secure/db/"/>
        <mkdir dir="${yawl.pdfforms.app.name}/secure/genDir/"/>
        <mkdir dir="${yawl.pdfforms.app.name}/WEB-INF/lib"/>
        <mkdir dir="${yawl.pdfforms.app.name}/WEB-INF/classes/au/edu/qut/yawl/worklist"/>
        <mkdir dir="${yawl.pdfforms.app.name}/WEB-INF/classes/au/edu/qut/yawl/elements/data"/>
        <mkdir dir="${yawl.pdfforms.app.name}/WEB-INF/classes/au/edu/qut/yawl/engine/interfce"/>
        <mkdir dir="${yawl.pdfforms.app.name}/WEB-INF/classes/au/edu/qut/yawl/PDFforms"/>
        <mkdir dir="${yawl.pdfforms.app.name}/WEB-INF/classes/au/edu/qut/yawl/PDFforms/signature"/>
        <!-- start copying files into war directory -->
        <copy todir="${yawl.pdfforms.app.name}/WEB-INF/classes/au/edu/qut/yawl/elements/data">
            <fileset
                dir="${classes}/au/edu/qut/yawl/elements/data"
                />
        </copy>
        <!-- start copying files into war directory -->
        <copy todir="${yawl.pdfforms.app.name}/WEB-INF/classes/au/edu/qut/yawl/elements">
            <fileset dir="${classes}/au/edu/qut/yawl/elements" includes="**/*.class **/*.xsd"/>
        </copy>
        <!-- start copying files into war directory -->
        <copy todir="${yawl.pdfforms.app.name}/WEB-INF/classes/au/edu/qut/yawl/unmarshal">
            <fileset
                dir="${classes}/au/edu/qut/yawl/unmarshal"
                includes="YDecompositionParser.class"/>
        </copy>
        <copy todir="${yawl.pdfforms.app.name}/WEB-INF/lib">
            <fileset dir="${basic.libs}" includes="jdom.jar"/>
        </copy>
        <copy todir="${yawl.pdfforms.app.name}/WEB-INF/lib" >
            <fileset dir="${basic.libs}" includes="log4j*.jar"/>
        </copy>
        <copy todir="${yawl.pdfforms.app.name}/WEB-INF/lib" >
            <fileset dir="${pdf.libs}"/>
        </copy>
        <copy todir="${yawl.pdfforms.app.name}/WEB-INF/lib" >
            <fileset dir="${persist.libs}"/>
        </copy>

        <copy file="${property.files}/log4j.properties" todir="${yawl.pdfforms.app.name}/WEB-INF/classes"/>
        <replace file="${yawl.pdfforms.app.name}/WEB-INF/classes/log4j.properties">
            <replacefilter token="%TOMCAT_DIR%" value="${env.CATALINA_HOME}"/>
            <!-- switch the slashes (adjust win separators) if necessary -->
            <replacefilter token="\" value="/" />
        </replace>

        <copy todir="${yawl.pdfforms.app.name}/WEB-INF/classes/au/edu/qut/yawl/engine/interfce">
            <fileset
                dir="${classes}/au/edu/qut/yawl/engine/interfce"/>
        </copy>
        <copy todir="${yawl.pdfforms.app.name}/WEB-INF/classes/au/edu/qut/yawl/engine/interfce/interfaceD_WorkItemExecution">
            <fileset
                dir="${classes}/au/edu/qut/yawl/engine/interfce/interfaceD_WorkItemExecution"/>
        </copy>
        <!-- copy all supportive jsps & graphis into webapp -->
        <copy todir="${yawl.pdfforms.app.name}">
            <fileset dir="${classes}/au/edu/qut/yawl/PDFforms">
                <include name="*.jsp"/>
            </fileset>
        </copy>
        <copy todir="${yawl.pdfforms.app.name}/graphics">
            <fileset dir="${basedir}/graphics"/>
        </copy>
        <!-- copy all major support classes into webapp -->
        <copy todir="${yawl.pdfforms.app.name}/WEB-INF/classes/au/edu/qut/yawl/PDFforms">
            <fileset dir="${classes}/au/edu/qut/yawl/PDFforms">
                <include name="*.class"/>
            </fileset>
        </copy>
        <copy todir="${yawl.worklist.app.name}/repository">
            <fileset dir="${build.home}/PDFforms/repository"/>
        </copy>
        <copy todir="${yawl.pdfforms.app.name}/WEB-INF/classes/au/edu/qut/yawl/PDFforms/signature">
            <fileset dir="${classes}/au/edu/qut/yawl/PDFforms/signature">
                <include name="*.class"/>
            </fileset>
        </copy>
        <copy todir="${yawl.pdfforms.app.name}/WEB-INF/classes/au/edu/qut/yawl/worklist/model">
            <fileset dir="${classes}/au/edu/qut/yawl/worklist/model"/>
        </copy>
        <copy todir="${yawl.pdfforms.app.name}/WEB-INF/classes/au/edu/qut/yawl/exceptions">
            <fileset dir="${classes}/au/edu/qut/yawl/exceptions"/>
        </copy>
        <copy todir="${yawl.pdfforms.app.name}/WEB-INF">
            <fileset file="${build.home}/${yawl.pdfforms.app.name}/web.xml"/>
        </copy>
        <!-- prepare Web Archive file -->
        <jar destfile="${output}/${yawl.pdfforms.app.name}.war">
            <fileset dir="${yawl.pdfforms.app.name}"/>
        </jar>
        <delete dir="${yawl.pdfforms.app.name}"/>
    </target>
</project>
