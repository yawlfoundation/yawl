<!-- $Id$ -->
<project name="YAWL Runtime" default="buildWebApps" basedir="./..">

    <!-- ========================== Properties ================================= -->

    <property name="app.version" value="_Release_2.0_beta(update1)"/>
    <property name="developer.name" value="Lachlan_Aldred, Michael Adams, Andrew Hastie,
                                           Mike Fowler, Matt Flaherty et al."/>

    <!-- Tomcat properties -->
    <property name="manager.url" value="http://localhost:8080/manager"/>   <!-- Keep -->
    <property file="./build/build.properties"/>

    <!-- AJH - New lines for Tomcat/Ant iface -->
    <property name="tomcat_manager_url"
              value="${tomcat.protocol}://${tomcat.address}:${tomcat.port}/manager"/>

    <!-- Access the environment -->
    <property environment="env"/>

    <!-- Source and resource directories -->
    <property name="build.dir" value="build"/>
    <property name="classes.dir" value="classes"/>
    <property name="graphics.dir" value="graphics"/>
    <property name="output.dir" value="output"/>
    <property name="schema.dir" value="schema"/>
    <property name="src.dir" value="src"/>
    <property name="test.dir" value="test"/>
    <property name="lib.dir" value="${build.dir}/3rdParty/lib"/>
    <property name="properties.dir" value="${build.dir}/properties"/>     <!-- AJH -->
    <property name="javadoc.dir" value="${output.dir}/javadoc"/>
    <property name="webapps.dir" value="${env.CATALINA_HOME}/webapps"/>
    <property name="xforms.dist" value="${build.dir}/yawlXForms/dist"/>
    <property name="enumeratedClasses" value="${build.dir}/3rdParty/enumerated3rdPartyClasses"/>
    <property name="packageRoot" value="/org/yawlfoundation/yawl"/>
    <property name="webinf.dir" value="/WEB-INF/classes${packageRoot}"/>

    <!-- Application names -->
    <property name="yawl.eng.app.name" value="yawl"/>
    <property name="yawl.worklist.app.name" value="worklist"/>
    <property name="yawl.webService.app.name" value="yawlWSInvoker"/>
    <property name="yawl.smsService.app.name" value="yawlSMSInvoker"/>
    <property name="yawl.timeService.app.name" value="timeService"/>
    <property name="yawl.xforms.app.name" value="yawlXForms"/>
    <property name="yawl.worklet.app.name" value="workletService"/>
    <property name="yawl.resource.app.name" value="resourceService"/>


    <!-- The various Hibernate database types. Set one of these to 'true' -->
    <property name="use_postgres7" value="false"/>
    <property name="use_postgres8" value="true"/>
    <property name="use_hypersonic" value="false"/>


    <!-- references to third party jars. NOTE: All updated or added jars should
         be listed here and referenced from here -->
    <property name="antlr"                 value="antlr-2.7.6.jar"/>
    <property name="apacheSoap"            value="apache_soap-2_3_1.jar"/>
    <property name="asm"                   value="asm.jar"/>
    <property name="axis"                  value="axis-1.1RC2.jar"/>
    <property name="axisAnt"               value="axis-1_1RC2-ant.jar"/>
    <property name="bcprov"                value="bcprov-jdk14-130.jar"/>
    <property name="cglib"                 value="cglib-2.1_3.jar"/>
    <property name="common"                value="common.jar"/>
    <property name="commonsBeanutils"      value="commons-beanutils.jar"/>
    <property name="commonsCollections"    value="commons-collections-3.2.jar"/>
    <property name="commonsDigester"       value="commons-digester.jar"/>
    <property name="commonsDiscovery"      value="commons-discovery.jar"/>
    <property name="commonsFileupload"     value="commons-fileupload-1.1.jar"/>
    <property name="commonsIO"             value="commons-io-1.1.jar"/>
    <property name="commonsLang"           value="commons-lang-2.3.jar"/>
    <property name="commonsLogging"        value="commons-logging-1.1.jar"/>
    <property name="dom"                   value="dom.jar"/>
    <property name="dom4j"                 value="dom4j-1.4.jar"/>
    <property name="ecore"                 value="ecore.jar"/>
    <property name="ehcache"               value="ehcache-1.3.0.jar"/>
    <property name="hibernate"             value="hibernate3.jar"/>
    <property name="hsql"                  value="hsqldb.jar"/>
    <property name="itext"                 value="itext-1.4.jar"/>
    <property name="jaxenFull"             value="jaxen-full.jar"/>
    <property name="jaxp-api"              value="jaxp-api.jar"/>
    <property name="jaxrpc"                value="jaxrpc.jar"/>
    <property name="jcommon"               value="jcommon-1.0.0-rc1.jar"/>
    <property name="jdom"                  value="jdom.jar"/>
    <property name="jfreechart"            value="jfreechart-1.0.0-rc1.jar"/>
    <property name="jsf-api"               value="jsf-api.jar"/>
    <property name="jsf-appbase"           value="appbase.jar"/>
    <property name="jsf-cl"                value="jsfcl.jar"/>
    <property name="jsf-dataprovider"      value="dataprovider.jar"/>
    <property name="jsf-defaulttheme-gray" value="defaulttheme-gray.jar"/>
    <property name="jsf-errorhandler"      value="errorhandler.jar"/>
    <property name="jsf-impl"              value="jsf-impl.jar"/>
    <property name="jstl"                  value="jstl.jar"/>
    <property name="jsf-rowset"            value="rowset.jar"/>
    <property name="jsf-standard"          value="standard.jar"/>
    <property name="jsf-webui"             value="webui.jar"/>
    <property name="jta"                   value="jta.jar"/>
    <property name="junit"                 value="junit.jar"/>
    <property name="log4j"                 value="log4j-1.2.14.jar"/>
    <property name="odmg"                  value="odmg-3.0.jar"/>
    <property name="optional"              value="optional-1_5_1.jar"/>
    <property name="postgres7"             value="postgresql-7.4.5.jdbc.jar"/>
    <property name="postgres8"             value="postgresql-8.3-603.jdbc3.jar"/>
    <property name="qname"                 value="qname-from-wsdl4j-20030807.jar"/>
    <property name="saaj"                  value="saaj.jar"/>
    <property name="sax"                   value="sax.jar"/>
    <property name="saxon"                 value="saxon7.jar"/>
    <property name="saxpath"               value="saxpath.jar"/>
    <property name="servlet"               value="servlet-api.jar"/>
    <property name="soaprmi"               value="soaprmi-1_1.jar"/>
    <property name="wsdl4j"                value="wsdl4j-20030807.jar"/>
    <property name="wsif"                  value="wsif.jar"/>
    <property name="wsif-j2c"              value="wsif-j2c.jar"/>
    <property name="xalan"                 value="xalan.jar"/>
    <property name="xerces"                value="xercesImpl.jar"/>
    <property name="xml-apis"              value="xml-apis.jar"/>
    <property name="xmlParserAPIs"         value="xmlParserAPIs-2_2_1.jar"/>
    <property name="xsd"                   value="xsd.jar"/>
    <property name="xsd.resources"         value="xsd.resources.jar"/>

    <!-- jar groups -->
    <property name="persistence.libs"
              value="${asm} ${antlr} ${cglib} ${commonsCollections}
                     ${commonsLogging} ${dom4j} ${ehcache} ${hibernate}
                     hibernate.cfg.xml ${jta} ${odmg}"/>

	  <property name="xsd.libs"
              value="${common} ${ecore} ${xsd} ${xsd.resources}"/>

    <property name="jsf.libs"
              value="${jsf-appbase} ${jsf-api} ${jsf-impl} ${jsf-cl} ${jsf-webui}
                     ${commonsDigester} ${commonsBeanutils} ${commonsFileupload}
                     ${commonsIO} ${jsf-standard} ${jstl} ${jsf-rowset}
                     ${jsf-dataprovider} ${jsf-errorhandler} ${jsf-defaulttheme-gray}"/>

    <property name="wsif.libs"
              value="${wsif} ${axis} ${commonsDiscovery} ${commonsLogging}
                     ${jaxrpc} ${saaj} ${wsdl4j} ${xmlParserAPIs}"/>

    <property name="common.libs"
              value="${junit} ${xerces} ${saxon} ${jdom} ${servlet} ${log4j}"/>


    <!-- ==================== Compilation Classpath =========================== -->

    <!-- Include all JAR files that will be included in /WEB-INF/lib -->
    <!-- *** CUSTOMIZE HERE AS REQUIRED BY YOUR APPLICATION *** -->
    <path id="cp.compile">
        <pathelement location="${lib.dir}/${junit}"/>
        <pathelement location="${lib.dir}/${xerces}"/>
        <pathelement location="${lib.dir}/${saxon}"/>
        <pathelement location="${lib.dir}/${jdom}"/>
        <pathelement location="${lib.dir}/${servlet}"/>
        <pathelement location="${lib.dir}/${log4j}"/>

        <!-- Include all elements that Tomcat exposes to applications -->
        <pathelement location="${env.CATALINA_HOME}/common/classes"/>
        <fileset dir="${env.CATALINA_HOME}/common/endorsed">
            <include name="*.jar"/>
        </fileset>
        <fileset dir="${env.CATALINA_HOME}/common/lib">
            <include name="*.jar"/>
        </fileset>
        <pathelement location="${env.CATALINA_HOME}/shared/classes"/>
        <fileset dir="${env.CATALINA_HOME}/shared/lib">
            <include name="*.jar"/>
        </fileset>
    </path>

    <path id="cp.standard">
        <pathelement path="${classes.dir}"/>
    </path>

    <path id="cp.wsif">
        <pathelement location="${lib.dir}/${wsif}"/>
        <pathelement location="${lib.dir}/${axis}"/>
        <pathelement location="${lib.dir}/${commonsDiscovery}"/>
        <pathelement location="${lib.dir}/${commonsLogging}"/>
        <pathelement location="${lib.dir}/${jaxrpc}"/>
        <pathelement location="${lib.dir}/${saaj}"/>
        <pathelement location="${lib.dir}/${wsdl4j}"/>
        <pathelement location="${lib.dir}/${xmlParserAPIs}"/>
    </path>

    <path id="cp.xsd">
        <pathelement location="${lib.dir}/${common}"/>
        <pathelement location="${lib.dir}/${ecore}"/>
        <pathelement location="${lib.dir}/${xsd}"/>
        <pathelement location="${lib.dir}/${xsd.resources}"/>
    </path>

    <path id="cp.persist">
        <pathelement location="${lib.dir}/${asm}"/>
        <pathelement location="${lib.dir}/${antlr}"/>
        <pathelement location="${lib.dir}/${cglib}"/>
        <pathelement location="${lib.dir}/${commonsCollections}"/>
        <pathelement location="${lib.dir}/${dom4j}"/>
        <pathelement location="${lib.dir}/${ehcache}"/>
        <pathelement location="${lib.dir}/${hibernate}"/>
        <pathelement location="${lib.dir}/${jta}"/>
        <pathelement location="${lib.dir}/${odmg}"/>
        <pathelement location="${lib.dir}/${hsql}"/>
        <pathelement location="${lib.dir}/${postgres7}"/>
        <pathelement location="${lib.dir}/${postgres8}"/>
    </path>

    <path id="cp.apacheCommons">
        <pathelement location="${lib.dir}/${commonsBeanutils}"/>
        <pathelement location="${lib.dir}/${commonsLang}"/>
        <pathelement location="${lib.dir}/${commonsDigester}"/>
        <pathelement location="${lib.dir}/${commonsFileupload}"/>
        <pathelement location="${lib.dir}/${commonsIO}"/>
    </path>

    <path id="cp.jsf">
        <pathelement location="${lib.dir}/${jsf-appbase}"/>
        <pathelement location="${lib.dir}/${jsf-api}"/>
        <pathelement location="${lib.dir}/${jsf-cl}"/>
        <pathelement location="${lib.dir}/${jsf-impl}"/>
        <pathelement location="${lib.dir}/${jsf-webui}"/>
        <pathelement location="${lib.dir}/${jsf-standard}"/>
        <pathelement location="${lib.dir}/${jstl}"/>
        <pathelement location="${lib.dir}/${jsf-rowset}"/>
        <pathelement location="${lib.dir}/${jsf-dataprovider}"/>
        <pathelement location="${lib.dir}/${jsf-errorhandler}"/>
        <pathelement location="${lib.dir}/${jsf-defaulttheme-gray}"/>
    </path>


    <!-- ============================ Targets =================================== -->

    <!--
    Copying examples and schema files
    -->
    <target name="copy">
        <copy todir="./exampleSpecs/xml">
            <fileset dir="./schema" includes="*.xsd"/>
        </copy>
        <copy todir="${src.dir}${packageRoot}/unmarshal">
            <fileset dir="${schema.dir}" includes="*.xsd"/>
        </copy>
        <copy todir="${test.dir}${packageRoot}/unmarshal">
            <fileset dir="./exampleSpecs/xml" includes="MakeRecordings.xml"/>
        </copy>
        <copy todir="${test.dir}${packageRoot}/engine">
            <fileset dir="./exampleSpecs/xml" includes="MakeRecordings(Beta4).xml"/>
        </copy>
    </target>

    <!--
    Clean build environment
    Deletes directories and intermediate files.
    -->
    <target name="clean" depends="copy">
        <delete dir="${classes.dir}"/>
        <delete dir="${output.dir}"/>
    </target>

    <!--
  	Initialise build environment
    Creates necessary directories prior to building.
  	-->
    <target name="init" depends="clean">
        <mkdir dir="${classes.dir}"/>
        <mkdir dir="${output.dir}"/>
        <mkdir dir="${javadoc.dir}"/>
    </target>

    <!--
    Compile all source
    Compiles main project source into ${classes.dir}.
    -->
    <target name="compile" depends="init">
        <javac srcdir="${src.dir}" debug="true" destdir="${classes.dir}"
               excludes="org/yawlfoundation/yawl/xformsupload/**">
            <classpath refid="cp.standard"/>
            <classpath refid="cp.compile"/>
            <classpath refid="cp.wsif"/>
            <classpath refid="cp.xsd"/>
            <classpath refid="cp.persist"/>
            <classpath refid="cp.apacheCommons"/>
            <classpath refid="cp.jsf"/>
        </javac>

        <!-- copy in non-java files from source (ie. files that don't need compiling) -->
        <copy todir="${classes.dir}">
            <fileset dir="${src.dir}" excludes="**/*.java"/>
        </copy>

        <!-- Copy and patch Log4J properties file in for free-standing engine -->
        <copy file="${properties.dir}/log4j.properties"
              todir="${classes.dir}" overwrite="true" />
    </target>


    <!-- Ascertain which Hibernate properties file to deploy for persistence -->
    <target name="decidePostgresVersion">
        <condition property="using_postgres7" value="true">
            <and>
                <contains string="${use_postgres7}" substring="true"/>
            </and>
        </condition>
        <condition property="using_postgres8" value="true">
            <and>
                <contains string="${use_postgres8}" substring="true"/>
            </and>
        </condition>
        <condition property="using_hypersonic" value="true">
            <and>
                <contains string="${use_hypersonic}" substring="true"/>
            </and>
        </condition>

        <antcall target="hibernate_postgres7"/>
        <antcall target="hibernate_postgres8"/>
    </target>


    <!--
    Build the application jar/war files
    Creates a jar file for the main application sources.
    -->
    <target name="build_Standalone" depends="compile">
        <mkdir dir="${enumeratedClasses}"/>
        <unzip dest="${enumeratedClasses}">
            <fileset dir="${lib.dir}"
                     includes="${persistence.libs} ${xsd.libs} ${common.libs} ${jcommon}
                               ${jfreechart} ${jaxenFull} ${postgres8} ${saxpath}
                               ${xml-apis}"
                     excludes="hibernate.cfg.xml"/>
        </unzip>	
    	
        <!-- Create a self contained jar of the YAWL library -->
        <antcall target="decidePostgresVersion"/>
        <jar destfile="${output.dir}/YAWL${app.version}_Standalone.jar">
            <fileset dir="${classes.dir}"  excludes="junit junit3.8.1"/>
            <fileset dir="${enumeratedClasses}"/>
            <manifest>
                <attribute name="Created-By" value="${developer.name}"/>
                <attribute name="Main-Class"
                           value="org/yawlfoundation/yawl/engine/gui/TabbedEngineGUI"/>
            </manifest>
        </jar>
        <delete dir="${enumeratedClasses}"/>
    </target>


    <!--
    Build the application jar/war files
    Creates a jar file for the main application sources.
    -->
    <target name="build_sourcecode" depends="compile">
        <copy todir="${classes.dir}">
            <fileset dir="${test.dir}" excludes="**/*.java"/>
        </copy>
        <copy todir="${output.dir}/engine/src">
            <fileset dir="${src.dir}"/>
        </copy>
        <copy todir="${output.dir}/engine/build">
            <fileset dir="${build.dir}"/>
        </copy>
        <copy todir="${output.dir}/engine/exampleSpecs">
            <fileset dir="exampleSpecs"/>
        </copy>
        <copy todir="${output.dir}/engine/graphics">
            <fileset dir="${graphics.dir}"/>
        </copy>
        <copy todir="${output.dir}/engine/schema">
            <fileset dir="${schema.dir}"/>
        </copy>
        <jar destfile="${output.dir}/YAWL${app.version}_SRC.zip" excludes="">
            <fileset dir="${output.dir}/engine"/>
        </jar>
        <copy todir="${output.dir}/engine/test">
            <fileset dir="${test.dir}"/>
        </copy>
        <jar destfile="${output.dir}/YAWL${app.version}-SourceAndTestCode.zip">
            <fileset dir="${output.dir}/engine"/>
        </jar>
        <delete dir="${output.dir}/engine"/>
    </target>


    <target name="BuildYawlStuff">
        <jar destfile="YAWLStuff.zip">
            <fileset dir="${output.dir}"/>
        </jar>
    </target>


    <!-- Build the engine (yawl.war) -->
    <target name="build_engine.war" depends="compile">
        <copy todir="${yawl.eng.app.name}${webinf.dir}/authentication">
            <fileset dir="${classes.dir}${packageRoot}/authentication"
                     includes="*.class *.hbm.xml"/>
        </copy>
        <copy todir="${yawl.eng.app.name}${webinf.dir}/elements">
            <fileset dir="${classes.dir}${packageRoot}/elements"
                     includes="**/*.class **/*.hbm.xml"/>
        </copy>
        <copy todir="${yawl.eng.app.name}${webinf.dir}/engine">
            <fileset dir="${classes.dir}${packageRoot}/engine"
                     includes="**/*.class **/*.hbm.xml"/>
        </copy>
        <copy todir="${yawl.eng.app.name}${webinf.dir}/exceptions">
            <fileset dir="${classes.dir}${packageRoot}/exceptions"
                     includes="*.class *.hbm.xml"/>
        </copy>
        <copy todir="${yawl.eng.app.name}${webinf.dir}/forms">
            <fileset dir="${classes.dir}${packageRoot}/forms"
                     includes="*.class"/>
        </copy>
        <copy todir="${yawl.eng.app.name}${webinf.dir}/jspLibrary">
            <fileset dir="${classes.dir}${packageRoot}/jspLibrary"
                     includes="*.jsp"/>
        </copy>
        <copy todir="${yawl.eng.app.name}${webinf.dir}/logging">
            <fileset dir="${classes.dir}${packageRoot}/logging"
                     includes="*.class *.hbm.xml"/>
        </copy>
        <copy todir="${yawl.eng.app.name}${webinf.dir}/schema">
            <fileset dir="${classes.dir}${packageRoot}/schema"
                     includes="*.class"/>
        </copy>
        <copy todir="${yawl.eng.app.name}${webinf.dir}/servicePersistence">
            <fileset dir="${classes.dir}${packageRoot}/servicePersistence"
                     includes="*.class"/>
        </copy>
        <copy todir="${yawl.eng.app.name}${webinf.dir}/unmarshal">
            <fileset dir="${classes.dir}${packageRoot}/unmarshal"
                     includes="*.class *.xsd"/>
        </copy>
        <copy todir="${yawl.eng.app.name}${webinf.dir}/util">
            <fileset dir="${classes.dir}${packageRoot}/util"
                     includes="*.class"/>
        </copy>

        <copy file="${properties.dir}/log4j.properties"
              todir="${yawl.eng.app.name}/WEB-INF/classes"/>
        <copy file="${properties.dir}/yawl.properties"
              todir="${yawl.eng.app.name}/WEB-INF/classes"/>
        <copy todir="${yawl.eng.app.name}/WEB-INF"
              file="${build.dir}/engine/web.xml"/>

        <copy todir="${yawl.eng.app.name}/WEB-INF/lib">
            <fileset dir="${lib.dir}"
                     includes="${persistence.libs} ${xsd.libs} ${common.libs}
                     ${jaxenFull} ${jcommon} ${postgres8} ${saxpath}"
                     excludes="${servlet}"/>
        </copy>
        <antcall target="decidePostgresVersion"/>
        <jar destfile="${output.dir}/yawl.war">
            <fileset dir="${yawl.eng.app.name}"/>
        </jar>
        <delete dir="${yawl.eng.app.name}"/>
    </target>

    
    <target name="hibernate_postgres7" if="using_postgres7">
        <echo message="Copying Hibernate properties for PostgreSQL7"/>
        <copy file="${lib.dir}/${postgres7}" todir="${yawl.eng.app.name}/WEB-INF/lib"/>
        <copy file="${properties.dir}/hibernate.properties.postgres7"
              tofile="${yawl.eng.app.name}/WEB-INF/classes/hibernate.properties"/>
        <copy file="${properties.dir}/hibernate.properties.postgres7"
              tofile="${classes.dir}/hibernate.properties"/>
        <copy file="${lib.dir}/${postgres7}"
              todir="${yawl.worklist.app.name}/WEB-INF/lib"/>
        <copy file="${properties.dir}/hibernate.properties.postgres7"
              tofile="${yawl.worklist.app.name}/WEB-INF/classes/hibernate.properties"/>
    </target>

    <target name="hibernate_postgres8" if="using_postgres8">
        <echo message="Copying Hibernate properties for PostgreSQL8"/>
        <copy file="${lib.dir}/${postgres8}" todir="${yawl.eng.app.name}/WEB-INF/lib"/>
        <copy file="${properties.dir}/hibernate.properties.postgres8"
              tofile="${yawl.eng.app.name}/WEB-INF/classes/hibernate.properties"/>
        <copy file="${properties.dir}/hibernate.properties.postgres8"
              tofile="${classes.dir}/hibernate.properties"/>
        <copy file="${lib.dir}/${postgres8}"
              todir="${yawl.worklist.app.name}/WEB-INF/lib"/>
        <copy file="${properties.dir}/hibernate.properties.postgres8"
              tofile="${yawl.worklist.app.name}/WEB-INF/classes/hibernate.properties"/>
    </target>


    <!-- Build old YAWL Worklist WebApplication -->
    <target name="build_worklist.war" depends="compile">

        <!-- Copy library dependencies into worklist -->
        <copy todir="${yawl.worklist.app.name}/WEB-INF/lib" >
            <fileset dir="${lib.dir}"
                     includes="${persistence.libs} ${xsd.libs} ${common.libs} ${bcprov}
                     ${commonsFileupload} ${dom} ${itext} ${jaxenFull} ${jaxp-api}
                     ${jcommon} ${jstl} ${postgres8} ${saxpath} ${jsf-standard}"
                     excludes="${servlet}"/>                
        </copy>  	
    	
        <antcall target="decidePostgresVersion"/>
        <copy todir="${yawl.worklist.app.name}${webinf.dir}/exceptions">
            <fileset dir="${classes.dir}${packageRoot}/exceptions"
                     includes="*.class *.hbm.xml"/>
        </copy>
        <copy todir="${yawl.worklist.app.name}${webinf.dir}/schema">
            <fileset dir="${classes.dir}${packageRoot}/schema" includes="*.class"/>
        </copy>
        <copy todir="${yawl.worklist.app.name}${webinf.dir}/forms">
            <fileset dir="${classes.dir}${packageRoot}/forms" includes="*.class"/>
        </copy>
        <copy todir="${yawl.worklist.app.name}${webinf.dir}/authentication">
            <fileset dir="${classes.dir}${packageRoot}/authentication"
                includes="User.class"/>
        </copy>
        <copy todir="${yawl.worklist.app.name}${webinf.dir}/elements">
            <fileset dir="${classes.dir}${packageRoot}/elements" includes="**/*.class **/*.xsd"/>
        </copy>
        <copy todir="${yawl.worklist.app.name}${webinf.dir}/unmarshal">
            <fileset dir="${classes.dir}${packageRoot}/unmarshal"
                includes="YDecompositionParser.class SchemaValidator.class
                          SchemaForSchemaValidator.class"/>
            <fileset dir="${schema.dir}" includes="*.xsd"/>
        </copy>

        <copy todir="${yawl.worklist.app.name}${webinf.dir}/elements/data">
            <fileset dir="${classes.dir}${packageRoot}/elements/data"
                includes="YParameter.class YVariable.class"/>
        </copy>

        <copy file="${properties.dir}/log4j.properties"
              todir="${yawl.worklist.app.name}/WEB-INF/classes"/>

        <copy todir="${yawl.worklist.app.name}${webinf.dir}/util">
            <fileset dir="${classes.dir}${packageRoot}/util"
                     includes= "JDOMUtil.class StringUtil.class"/>
        </copy>

        <copy todir="${yawl.worklist.app.name}${webinf.dir}/engine/interfce/interfaceA">
            <fileset dir="${classes.dir}${packageRoot}/engine/interfce/interfaceA"/>
        </copy>

        <copy todir="${yawl.worklist.app.name}${webinf.dir}/engine/interfce/interfaceB">
            <fileset dir="${classes.dir}${packageRoot}/engine/interfce/interfaceB"/>
        </copy>

        <copy todir="${yawl.worklist.app.name}${webinf.dir}/engine/interfce">
            <fileset dir="${classes.dir}${packageRoot}/engine/interfce"/>
        </copy>

        <!-- copy all major support classes into webapp -->
        <copy todir="${yawl.worklist.app.name}${webinf.dir}/worklist">
            <fileset dir="${classes.dir}${packageRoot}/worklist">
                <include name="**/*.class"/>
            </fileset>
        </copy>

        <!-- copy all supportive jsps into webapp -->
        <copy todir="${yawl.worklist.app.name}">
            <fileset dir="${classes.dir}${packageRoot}/worklist">
                <exclude name="*.class"/>
            </fileset>
        </copy>
        <copy todir="${yawl.worklist.app.name}/WEB-INF">
            <fileset file="${build.dir}/${yawl.worklist.app.name}/web.xml"/>
        </copy>
        <copy todir="${yawl.worklist.app.name}/graphics">
            <fileset dir="${graphics.dir}"/>
        </copy>

        <!-- prepare Web ARchive file -->
        <jar destfile="${output.dir}/${yawl.worklist.app.name}.war">
            <fileset dir="${yawl.worklist.app.name}"/>
        </jar>
        <delete dir="${yawl.worklist.app.name}"/>
    </target>


    <!-- Build the YAWL Web Service Invoker WebApplication -->
    <target name="build_yawlWSInvoker.war" depends="compile">
        <copy todir="${yawl.webService.app.name}${webinf.dir}/elements">
            <fileset dir="${classes.dir}${packageRoot}/elements" includes="**/*.class **/*.xsd"/>
        </copy>
        <copy todir="${yawl.webService.app.name}${webinf.dir}/util">
            <fileset dir="${classes.dir}${packageRoot}/util"
                     includes="JDOMUtil.class StringUtil.class"/>
        </copy>
        <copy todir="${yawl.webService.app.name}${webinf.dir}/unmarshal">
            <fileset dir="${classes.dir}${packageRoot}/unmarshal"
                includes="YDecompositionParser.class"/>
            <fileset dir="${schema.dir}" includes="*.xsd"/>
        </copy>
        <copy todir="${yawl.webService.app.name}/WEB-INF/lib">
            <fileset dir="${lib.dir}"
                     includes="${wsif.libs} ${apacheSoap} ${axisAnt} ${jdom} ${log4j}
                               ${optional} ${qname} ${soaprmi} ${wsif-j2c} ${xerces}
                               README.html"/>
        </copy>

        <copy file="${properties.dir}/log4j.properties"
              todir="${yawl.webService.app.name}/WEB-INF/classes"/>

        <copy todir="${yawl.webService.app.name}${webinf.dir}/engine/interfce">
            <fileset dir="${classes.dir}${packageRoot}/engine/interfce"/>
        </copy>

        <copy todir="${yawl.webService.app.name}${webinf.dir}/engine/interfce/interfaceA">
            <fileset dir="${classes.dir}${packageRoot}/engine/interfce/interfaceA"/>
        </copy>
        <copy todir="${yawl.webService.app.name}${webinf.dir}/engine/interfce/interfaceB">
            <fileset dir="${classes.dir}${packageRoot}/engine/interfce/interfaceB"/>
        </copy>

        <copy todir="${yawl.webService.app.name}${webinf.dir}/exceptions">
             <fileset dir="${classes.dir}${packageRoot}/exceptions"
                      includes="*.class *.hbm.xml"/>
        </copy>
        <copy todir="${yawl.webService.app.name}${webinf.dir}/worklist/model">
             <fileset dir="${classes.dir}${packageRoot}/worklist/model"/>
        </copy>

        <!-- copy all major support classes into webapp -->
        <copy todir="${yawl.webService.app.name}${webinf.dir}/wsif">
            <fileset dir="${classes.dir}${packageRoot}/wsif">
                <include name="*.class"/>
            </fileset>
        </copy>
        <copy todir="${yawl.webService.app.name}">
            <fileset dir="${classes.dir}${packageRoot}/wsif">
                <include name="*.jsp"/>
            </fileset>
        </copy>
         <copy todir="${yawl.webService.app.name}/WEB-INF">
            <fileset file="${build.dir}/${yawl.webService.app.name}/web.xml"/>
        </copy>
        <!-- prepare Web ARchive file -->
        <jar destfile="${output.dir}/${yawl.webService.app.name}.war">
            <fileset dir="${yawl.webService.app.name}"/>
        </jar>
        <delete dir="${yawl.webService.app.name}"/>
    </target>


    <!-- Build the YAWL SMS Service Invoker WebApplication -->
    <target name="build_yawlSMSInvoker.war" depends="compile">
        <copy todir="${yawl.smsService.app.name}${webinf.dir}/elements">
            <fileset dir="${classes.dir}${packageRoot}/elements"
                     includes="**/*.class **/*.xsd"/>
        </copy>
        <copy todir="${yawl.smsService.app.name}${webinf.dir}/unmarshal">
            <fileset
                dir="${classes.dir}${packageRoot}/unmarshal"
                includes="YDecompositionParser.class"/>
            <fileset dir="${schema.dir}" includes="*.xsd"/>
        </copy>
        <copy todir="${yawl.smsService.app.name}/WEB-INF/lib">
            <fileset dir="${lib.dir}" includes="${jdom} ${log4j}"/>
        </copy>

        <copy file="${properties.dir}/log4j.properties"
              todir="${yawl.smsService.app.name}/WEB-INF/classes"/>

        <copy todir="${yawl.smsService.app.name}${webinf.dir}/engine/interfce">
            <fileset dir="${classes.dir}${packageRoot}/engine/interfce"/>
        </copy>
        <copy todir="${yawl.smsService.app.name}${webinf.dir}/engine/interfce/interfaceA">
            <fileset dir="${classes.dir}${packageRoot}/engine/interfce/interfaceA"/>
        </copy>
        <copy todir="${yawl.smsService.app.name}${webinf.dir}/engine/interfce/interfaceB">
            <fileset dir="${classes.dir}${packageRoot}/engine/interfce/interfaceB"/>
        </copy>

        <!-- copy all supportive jsps & graphis into webapp -->
        <copy todir="${yawl.smsService.app.name}">
            <fileset dir="${classes.dir}${packageRoot}/smsModule">
                <exclude name="*.class"/>
            </fileset>
        </copy>
        <copy todir="${yawl.smsService.app.name}/graphics">
            <fileset dir="${graphics.dir}"/>
        </copy>
        <!-- copy all major support classes into webapp -->
        <copy todir="${yawl.smsService.app.name}${webinf.dir}/smsModule">
            <fileset dir="${classes.dir}${packageRoot}/smsModule">
                <include name="*.class"/>
            </fileset>
        </copy>
        <copy todir="${yawl.smsService.app.name}${webinf.dir}/worklist/model">
            <fileset dir="${classes.dir}${packageRoot}/worklist/model"/>
        </copy>
        <copy todir="${yawl.smsService.app.name}${webinf.dir}/exceptions">
            <fileset dir="${classes.dir}${packageRoot}/exceptions"
                includes="YAWLException.class"/>
        </copy>
        <copy todir="${yawl.smsService.app.name}/WEB-INF">
            <fileset file="${build.dir}/${yawl.smsService.app.name}/web.xml"/>
        </copy>
        <!-- prepare Web Archive file -->
        <jar destfile="${output.dir}/${yawl.smsService.app.name}.war">
            <fileset dir="${yawl.smsService.app.name}"/>
        </jar>
        <delete dir="${yawl.smsService.app.name}"/>
    </target>


    <!-- Build the YAWL Time Service WebApplication -->
    <target name="build_TimeService.war" depends="compile">
        <copy todir="${yawl.timeService.app.name}${webinf.dir}/elements">
            <fileset dir="${classes.dir}${packageRoot}/elements" includes="**/*.class **/*.xsd"/>
        </copy>
        <copy todir="${yawl.timeService.app.name}${webinf.dir}/unmarshal">
            <fileset dir="${classes.dir}${packageRoot}/unmarshal"
                includes="YDecompositionParser.class"/>
            <fileset dir="${schema.dir}" includes="*.xsd"/>
        </copy>
        <copy todir="${yawl.timeService.app.name}${webinf.dir}/worklist/model">
             <fileset dir="${classes.dir}${packageRoot}/worklist/model"/>
        </copy>
        <copy todir="${yawl.timeService.app.name}${webinf.dir}/exceptions">
             <fileset dir="${classes.dir}${packageRoot}/exceptions"
                 includes="YAWLException.class"/>
        </copy>
        <copy todir="${yawl.timeService.app.name}/WEB-INF/lib">
            <fileset dir="${lib.dir}" includes="${jdom} ${log4j}"/>
        </copy>

        <copy file="${properties.dir}/log4j.properties"
              todir="${yawl.timeService.app.name}/WEB-INF/classes"/>

        <copy todir="${yawl.timeService.app.name}${webinf.dir}/engine/interfce">
            <fileset dir="${classes.dir}${packageRoot}/engine/interfce"/>
        </copy>
        <copy todir="${yawl.timeService.app.name}${webinf.dir}/engine/interfce/interfaceB">
             <fileset dir="${classes.dir}${packageRoot}/engine/interfce/interfaceB"/>
         </copy>
        <copy todir="${yawl.timeService.app.name}${webinf.dir}/util">
              <fileset dir="${classes.dir}${packageRoot}/util"/>
        </copy>
        <copy todir="${yawl.timeService.app.name}">
            <fileset dir="${classes.dir}${packageRoot}/timeService">
                <exclude name="*.class"/>
            </fileset>
        </copy>
        <copy todir="${yawl.timeService.app.name}/graphics">
            <fileset dir="${graphics.dir}"/>
        </copy>
        <copy todir="${yawl.timeService.app.name}${webinf.dir}/timeService">
            <fileset dir="${classes.dir}${packageRoot}/timeService">
                <include name="*.class"/>
            </fileset>
        </copy>
        <copy todir="${yawl.timeService.app.name}/WEB-INF">
            <fileset file="${build.dir}/${yawl.timeService.app.name}/web.xml"/>
        </copy>
        <!-- prepare Web Archive file -->
        <jar destfile="${output.dir}/${yawl.timeService.app.name}.war">
            <fileset dir="${yawl.timeService.app.name}"/>
        </jar>
        <delete dir="${yawl.timeService.app.name}"/>
    </target>


	<!-- Build the WorkletService war file  -->
    <target name="build_workletService.war" depends="compile">

        <!-- 1. Copy required yawl classes into dir structure -->
        <copy todir="${yawl.worklet.app.name}${webinf.dir}/authentication">
            <fileset dir="${classes.dir}${packageRoot}/authentication"
                     includes="User.class"/>
        </copy>
        <copy todir="${yawl.worklet.app.name}${webinf.dir}/engine/interfce">
            <fileset dir="${classes.dir}${packageRoot}/engine/interfce"/>
        </copy>
        <copy todir="${yawl.worklet.app.name}${webinf.dir}/elements">
            <fileset dir="${classes.dir}${packageRoot}/elements"
                     includes="*.class" />
        </copy>
        <copy todir="${yawl.worklet.app.name}${webinf.dir}/elements/data">
            <fileset dir="${classes.dir}${packageRoot}/elements/data"
                     includes="YParameter.class YVariable.class"/>
        </copy>
        <copy todir="${yawl.worklet.app.name}${webinf.dir}/elements/state">
            <fileset dir="${classes.dir}${packageRoot}/elements/state"
                     includes="YIdentifier.class"/>
        </copy>
    	  <copy todir="${yawl.worklet.app.name}${webinf.dir}/exceptions">
    	   <fileset dir="${classes.dir}${packageRoot}/exceptions"
    	            includes="YSchemaBuildingException.class
    	                      YSyntaxException.class YAWLException.class" />
      	</copy>
      	<copy todir="${yawl.worklet.app.name}${webinf.dir}/schema">
      	   <fileset dir="${classes.dir}${packageRoot}/schema" includes="*.class" />
      	</copy>
        <copy todir="${yawl.worklet.app.name}${webinf.dir}/unmarshal">
            <fileset dir="${classes.dir}${packageRoot}/unmarshal"
                     includes="YDecompositionParser.class SchemaValidator.class
                               SchemaForSchemaValidator.class"/>
            <fileset dir="${schema.dir}" includes="*.xsd"/>
        </copy>
        <copy todir="${yawl.worklet.app.name}${webinf.dir}/util">
              <fileset dir="${classes.dir}${packageRoot}/util"
                       includes="JDOMUtil.class StringUtil.class"/>
        </copy>

        <!-- 2. copy worklet classes to relevant dirs -->
        <copy todir="${yawl.worklet.app.name}${webinf.dir}/worklet"
              file="${classes.dir}${packageRoot}/worklet/WorkletService.class"/>
        <copy todir="${yawl.worklet.app.name}${webinf.dir}/worklet/rdr">
            <fileset dir="${classes.dir}${packageRoot}/worklet/rdr"
                     includes="*.class"/>
        </copy>
        <copy todir="${yawl.worklet.app.name}${webinf.dir}/worklet/selection">
            <fileset dir="${classes.dir}${packageRoot}/worklet/selection"
                     includes="*.class *.xml"/>
        </copy>
        <copy todir="${yawl.worklet.app.name}${webinf.dir}/worklet/support">
            <fileset dir="${classes.dir}${packageRoot}/worklet/support"
                     includes="*.class *.xml"/>
        </copy>
        <copy todir="${yawl.worklet.app.name}${webinf.dir}/worklet/exception">
            <fileset dir="${classes.dir}${packageRoot}/worklet/exception"
                     includes="*.class *.xml"/>
        </copy>
        <copy todir="${yawl.worklet.app.name}${webinf.dir}/worklet/admin">
            <fileset dir="${classes.dir}${packageRoot}/worklet/admin"
                     includes="*.class *.xml"/>
        </copy>

    	<!-- 2b. Copy required worklet support files into dir root -->
        <copy todir="${yawl.worklet.app.name}"
              file="${build.dir}/workletService/welcome/welcome.htm"/>
        <copy todir="${yawl.worklet.app.name}/repository">
        	<fileset dir="${build.dir}/workletService/repository"/>
        </copy>

        <!-- 2c. Copy in graphics for welcome page -->
        <copy todir="${yawl.worklet.app.name}/graphics">
        	<fileset dir="${build.dir}/workletService/welcome/graphics"/>
        </copy>
        <copy todir="${yawl.worklet.app.name}/graphics" file="${graphics.dir}/common.css"/>
        <copy todir="${yawl.worklet.app.name}/graphics" file="${graphics.dir}/subtext.jpg"/>
        <copy todir="${yawl.worklet.app.name}/graphics" file="${graphics.dir}/yawl.swf"/>

        <!-- 2d. Copy in jsps -->
        <copy todir="${yawl.worklet.app.name}/jsp">
             <fileset dir="${classes.dir}${packageRoot}/worklet/jsp"/>
        </copy>

        <!-- 2e. Copy log4j properties -->
        <copy file="${properties.dir}/log4j.properties"
              todir="${yawl.worklet.app.name}/WEB-INF/classes"/>

        <!-- 3. Copy required 3rd party libraries into dir structure -->
      	<copy todir="${yawl.worklet.app.name}/WEB-INF/lib">
    	    <fileset dir="${lib.dir}"
                   includes="${persistence.libs} ${xsd.libs} ${jdom} ${log4j}
                             ${postgres8}"/>
        </copy>

        <!-- 4. Copy hibernate & postgres files (assumes version 8) -->
        <copy file="${properties.dir}/hibernate.properties.postgres8"
            tofile="${yawl.worklet.app.name}/WEB-INF/classes/hibernate.properties"/>

        <!-- 5. Copy web.xml file into dir structure -->
        <copy todir="${yawl.worklet.app.name}/WEB-INF"
              file="${build.dir}/workletService/web.xml"/>

        <!-- 6. create Web Archive file -->
        <jar destfile="${output.dir}/workletService.war">
            <fileset dir="${yawl.worklet.app.name}"/>
        </jar>

        <!-- 7. Remove temp build area -->
        <delete dir="${yawl.worklet.app.name}"/>
    </target>


    <!-- Build the resourceService war file  -->
    <target name="build_resourceService.war" depends="compile">

        <!-- 1. Copy required yawl classes into dir structure -->
        <copy todir="${yawl.resource.app.name}${webinf.dir}/authentication">
            <fileset dir="${classes.dir}${packageRoot}/authentication"
                     includes="User.class"/>
        </copy>
        <copy todir="${yawl.resource.app.name}${webinf.dir}/engine/interfce">
            <fileset dir="${classes.dir}${packageRoot}/engine/interfce"/>
        </copy>
        <copy todir="${yawl.resource.app.name}${webinf.dir}/elements">
            <fileset dir="${classes.dir}${packageRoot}/elements"
                     includes="*.class" />
        </copy>
        <copy todir="${yawl.resource.app.name}${webinf.dir}/elements/data">
            <fileset dir="${classes.dir}${packageRoot}/elements/data"
                     includes="YParameter.class YVariable.class"/>
        </copy>
        <copy todir="${yawl.resource.app.name}${webinf.dir}/elements/state">
            <fileset dir="${classes.dir}${packageRoot}/elements/state"
                     includes="YIdentifier.class"/>
        </copy>
        <copy todir="${yawl.resource.app.name}${webinf.dir}/exceptions">
           <fileset dir="${classes.dir}${packageRoot}/exceptions"
                    includes="YSchemaBuildingException.class YDataStateException.class
                              YSyntaxException.class YAWLException.class
                              YStateException.class YQueryException.class" />
        </copy>

        <copy todir="${yawl.resource.app.name}${webinf.dir}/forms">
           <fileset dir="${classes.dir}${packageRoot}/forms" includes="*.class" />
        </copy>

        <copy todir="${yawl.resource.app.name}${webinf.dir}/schema">
           <fileset dir="${classes.dir}${packageRoot}/schema" includes="*.class" />
        </copy>

        <copy todir="${yawl.resource.app.name}${webinf.dir}/unmarshal">
            <fileset dir="${classes.dir}${packageRoot}/unmarshal"
                     includes="YDecompositionParser.class SchemaValidator.class
                               SchemaForSchemaValidator.class"/>
            <fileset dir="${schema.dir}" includes="*.xsd"/>
        </copy>

        <copy todir="${yawl.resource.app.name}${webinf.dir}/util">
              <fileset dir="${classes.dir}${packageRoot}/util"
                       includes="JDOMUtil.class StringUtil.class"/>
        </copy>

        <!-- 2. copy resourcing classes to relevant dirs -->
        <copy todir="${yawl.resource.app.name}${webinf.dir}/resourcing">
            <fileset dir="${classes.dir}${packageRoot}/resourcing"
                     includes="**/*.class **/*.xml **/*.properties"/>
        </copy>

        <!-- 2b. Copy required resourcing support files into dir root -->
        <copy todir="${yawl.resource.app.name}"
              file="${build.dir}/resourceService/welcome/welcome.htm"/>

        <!-- 2c. Copy in graphics for welcome page -->
        <copy todir="${yawl.resource.app.name}/graphics">
            <fileset dir="${build.dir}/resourceService/welcome/graphics"/>
        </copy>
        <copy todir="${yawl.resource.app.name}/graphics" file="${graphics.dir}/common.css"/>
        <copy todir="${yawl.resource.app.name}/graphics" file="${graphics.dir}/subtext.jpg"/>
        <copy todir="${yawl.resource.app.name}/graphics" file="${graphics.dir}/yawl.swf"/>

        <!-- 2c(i). Copy in resources for jsps -->
        <copy todir="${yawl.resource.app.name}/resources">
            <fileset dir="${build.dir}/resourceService/resources"/>
        </copy>

        <!-- 2d. Copy in jsps -->
        <copy todir="${yawl.resource.app.name}">
            <fileset dir="${classes.dir}${packageRoot}/resourcing/jsf/jsp"
                     includes="*.jsp *.jspf *.html"/>
        </copy>

        <!-- 2e. Copy log4j properties -->
        <copy file="${properties.dir}/log4j.properties"
              todir="${yawl.resource.app.name}/WEB-INF/classes"/>

        <!-- 3. Copy required 3rd party libraries into dir structure -->
        <copy todir="${yawl.resource.app.name}/WEB-INF/lib">
           <fileset dir="${lib.dir}"
                    includes="${persistence.libs} ${xsd.libs} ${jdom} ${log4j}
                    ${postgres8} ${jsf.libs} ${saxon} ${commonsLang} ${xerces}"/>
        </copy>

        <copy todir="${yawl.resource.app.name}/WEB-INF">
           <fileset dir="${build.dir}/resourceService/jsf_xml" includes="*.xml"/>
        </copy>  

        <!-- 4. Copy hibernate & postgres files (assumes version 8) -->
        <copy file="${properties.dir}/hibernate.properties.postgres8"
            tofile="${yawl.resource.app.name}/WEB-INF/classes/hibernate.properties"/>

        <!-- 5. Copy web.xml file into dir structure -->
        <copy todir="${yawl.resource.app.name}/WEB-INF"
              file="${build.dir}/resourceService/web.xml"/>

        <!-- 6. create Web Archive file -->
        <jar destfile="${output.dir}/resourceService.war">
            <fileset dir="${yawl.resource.app.name}"/>
        </jar>

        <!-- 7. Remove temp build area -->
        <delete dir="${yawl.resource.app.name}"/>
    </target>


    <!-- Build the test service -->
    <target name="build_testService.war" depends="compile">
        <copy todir="testService${webinf.dir}/elements/data">
            <fileset dir="${classes.dir}${packageRoot}/elements/data"/>
        </copy>
        <!-- start copying files into war directory -->
        <copy todir="testService${webinf.dir}/elements">
            <fileset dir="${classes.dir}${packageRoot}/elements"
                     includes="**/*.class **/*.xsd"/>
        </copy>
        <copy todir="testService${webinf.dir}/unmarshal">
            <fileset
                dir="${classes.dir}${packageRoot}/unmarshal"
                includes="YDecompositionParser.class"/>
            <fileset dir="${schema.dir}" includes="*.xsd"/>
        </copy>

        <copy todir="testService${webinf.dir}/resourcing/rsInterface">
            <fileset dir="${classes.dir}${packageRoot}/resourcing/rsInterface"/>
        </copy>
        <copy todir="testService${webinf.dir}/resourcing">
            <fileset dir="${classes.dir}${packageRoot}/resourcing"/>
        </copy>
        <copy todir="testService${webinf.dir}/resourcing/datastore/persistence">
            <fileset dir="${classes.dir}${packageRoot}/resourcing/datastore/persistence"/>
        </copy>
        <copy todir="testService${webinf.dir}/resourcing/allocators">
            <fileset dir="${classes.dir}${packageRoot}/resourcing/allocators"/>
        </copy>
        <copy todir="testService${webinf.dir}/resourcing/filters">
            <fileset dir="${classes.dir}${packageRoot}/resourcing/filters"/>
        </copy>
        <copy todir="testService${webinf.dir}/resourcing/constraints">
            <fileset dir="${classes.dir}${packageRoot}/resourcing/constraints"/>
        </copy>
        <copy todir="testService${webinf.dir}/resourcing/interactions">
            <fileset dir="${classes.dir}${packageRoot}/resourcing/interactions"/>
        </copy>
        <copy todir="testService${webinf.dir}/resourcing/resource">
            <fileset dir="${classes.dir}${packageRoot}/resourcing/resource"/>
        </copy>

        <copy todir="testService${webinf.dir}/util">
            <fileset dir="${classes.dir}${packageRoot}/util"/>
        </copy>
        <copy todir="testService/WEB-INF/lib">
            <fileset dir="${lib.dir}" includes="${jdom} ${log4j}"/>
        </copy>

        <copy file="${properties.dir}/log4j.properties"
              todir="testService/WEB-INF/classes"/>

        <copy todir="testService${webinf.dir}/engine/interfce">
            <fileset dir="${classes.dir}${packageRoot}/engine/interfce"/>
        </copy>
        <copy todir="testService${webinf.dir}/testService">
            <fileset dir="${classes.dir}${packageRoot}/testService"/>
        </copy>
        <copy todir="testService/graphics">
            <fileset dir="${graphics.dir}"/>
        </copy>
        <copy todir="testService${webinf.dir}/exceptions">
            <fileset dir="${classes.dir}${packageRoot}/exceptions"
                includes="YAWLException.class"/>
        </copy>
        <copy todir="testService/WEB-INF">
            <fileset file="${build.dir}/testService/web.xml"/>
        </copy>
        <!-- prepare Web Archive file -->
        <jar destfile="${output.dir}/testService.war">
            <fileset dir="testService"/>
        </jar>
        <delete dir="testService"/>
    </target>


    <!-- =========================================================================== -->
    <!--
    Build the application jar/war files
    -->
    <target name="buildWebApps"
        depends=
        "build_engine.war,
        build_worklist.war,
        build_yawlSMSInvoker.war,
        build_yawlWSInvoker.war,
        build_TimeService.war,
        build_workletService.war,
        build_resourceService.war"
        description=
        "Builds a distribution version of all
        the YAWL runtime Web apps and copies to the output directory.">
        <antcall target="cleanup"/>
    </target>

    <target name="deployWorklist" depends="build_worklist.war">
        <copy todir="${webapps.dir}">
            <fileset file="${output.dir}/${yawl.worklist.app.name}.war"/>
        </copy>
        <antcall target="cleanup"/>
    </target>

    <target name="deployEngine" depends="build_engine.war">
        <copy todir="${webapps.dir}">
            <fileset file="${output.dir}/${yawl.eng.app.name}.war"/>
        </copy>
        <antcall target="cleanup"/>
    </target>

    <target name="deployWsInvoker" depends="build_yawlWSInvoker.war">
        <copy todir="${webapps.dir}">
            <fileset file="${output.dir}/${yawl.webService.app.name}.war"/>
        </copy>
        <antcall target="cleanup"/>
    </target>

    <target name="deploySMS" depends="build_yawlSMSInvoker.war">
        <copy todir="${webapps.dir}">
            <fileset file="${output.dir}/${yawl.smsService.app.name}.war"/>
        </copy>
        <antcall target="cleanup"/>
    </target>

    <target name="deployTimeService" depends="build_TimeService.war">
        <copy todir="${webapps.dir}">
            <fileset file="${output.dir}/${yawl.timeService.app.name}.war"/>
        </copy>
        <antcall target="cleanup"/>
    </target>


    <target name="deployWorkletService" depends="build_workletService.war">
        <copy todir="${webapps.dir}">
            <fileset file="${output.dir}/${yawl.worklet.app.name}.war"/>
        </copy>
        <antcall target="cleanup"/>
    </target>

    <target name="deployResourceService" depends="build_resourceService.war">
        <copy todir="${webapps.dir}">
            <fileset file="${output.dir}/${yawl.resource.app.name}.war"/>
        </copy>
        <antcall target="cleanup"/>
    </target>

    <target name="deployTestService" depends="build_testService.war">
        <copy todir="${webapps.dir}">
            <fileset file="${output.dir}/testService.war"/>
        </copy>
        <antcall target="cleanup"/>
    </target>


    <target name="deployWebapps"
        depends=
        "deployWorklist,
        deployEngine,
        deployWsInvoker,
        deploySMS,
        deployTimeService,
        deployWorkletService,
        deployResourceService"
        description=
        "Deploys all of the web apps to Tomcat, and if tomcat is on it forces a reload.">
    </target>

    <target name="cleanup">
        <delete dir="${yawl.eng.app.name}"/>
        <delete dir="${yawl.worklist.app.name}"/>
        <delete dir="${yawl.worklet.app.name}"/>
        <delete dir="${yawl.resource.app.name}"/>
    </target>

    <!--
    Build the application jar/war files
    Creates a jar file for the main application sources.
    -->
    <target name="buildAll"
        depends="build_Standalone,
        build_sourcecode,
        build_engine.war,
        build_worklist.war,
        build_yawlWSInvoker.war,
        build_yawlSMSInvoker.war,
        build_TimeService.war,
        build_workletService.war,
        build_resourceService.war,
        javadoc">
    </target>

    <!--
  	Compile test source code
    Compiles the source for test cases into the ${classes} directory.
  	-->
    <target name="compile-test" depends="buildAll">
        <copy todir="${classes.dir}">
            <fileset dir="${test.dir}" excludes="**/*.java"/>
        </copy>
        <javac srcdir="${test.dir}" destdir="${classes.dir}">
            <classpath refid="cp.standard"/>
            <classpath refid="cp.compile"/>
            <classpath refid="cp.wsif"/>
            <classpath refid="cp.xsd"/>
            <classpath refid="cp.persist"/>
        </javac>
    </target>

    <!--
    Run the unit tests
    Invokes the unit tests.
    -->
    <target name="test" depends="compile-test">
        <java classname="org.yawlfoundation.yawl.TestAllYAWLSuites" fork="true"
              failonerror="false">
            <classpath refid="cp.standard"/>
            <classpath refid="cp.compile"/>
            <classpath refid="cp.wsif"/>
            <classpath refid="cp.xsd"/>
            <classpath refid="cp.persist"/>
        </java>
    </target>


    <target name="compile-test2" depends="build_engine.war">
         <copy todir="${classes.dir}">
             <fileset dir="${test.dir}" excludes="**/*.java"/>
         </copy>
         <javac srcdir="${test.dir}" destdir="${classes.dir}">
             <classpath refid="cp.standard"/>
             <classpath refid="cp.compile"/>
             <classpath refid="cp.wsif"/>
             <classpath refid="cp.xsd"/>
             <classpath refid="cp.persist"/>
         </javac>
     </target>


    <!--
    Run the resourcing unit tests
    -->
    <target name="resourcingtest" depends="compile-test">
        <java classname="org.yawlfoundation.yawl.resourcing.ResourcingTestSuite"
              fork="true" failonerror="false">
            <classpath refid="cp.standard"/>
            <classpath refid="cp.compile"/>
            <classpath refid="cp.wsif"/>
            <classpath refid="cp.xsd"/>
            <classpath refid="cp.persist"/>
            <classpath refid="cp.apacheCommons"/>
            <classpath refid="cp.jsf"/>
        </java>
    </target>


    <!--
    The "javadoc" target creates Javadoc API documentation for the Java
    classes included in your application.  Normally, this is only required
    when preparing a distribution release, but is available as a separate
    target in case the developer wants to create Javadocs independently.
    -->
    <target name="javadoc" depends="compile" description="Create Javadoc API documentation">
        <mkdir dir="${javadoc.dir}/docs/api"/>
        <javadoc sourcepath="${src.dir}" destdir="${javadoc.dir}/docs/api" packagenames="*">
            <classpath refid="cp.standard"/>
            <classpath refid="cp.compile"/>
            <classpath refid="cp.wsif"/>
            <classpath refid="cp.xsd"/>
            <classpath refid="cp.persist"/>
            <classpath refid="cp.apacheCommons"/>
            <classpath refid="cp.jsf"/>
        </javadoc>
    </target>


    <!-- Deployment targets using the Tomcat Manager -->
    <!-- disabled -->

    <!-- AJH - Added Tomcat deployment target -->
    <!--
    <target name="deploy_tomcat_localhost"
        depends="buildWebApps"
        description="Deploy the web applications into Tomcat">
        <echo message="Deploying web applications via ${tomcat_manager_url}"/>

        <echo message="Deploying ${yawl.eng.app.name}"/>
        <deploy url="${tomcat_manager_url}"
            username="${tomcat.manager.username}"
            password="${tomcat.manager.password}"
            path="/${yawl.eng.app.name}"
            war="../${output.dir}/${yawl.eng.app.name}.war"
            update="true"/>

        <echo message="Deploying ${yawl.worklist.app.name}"/>
        <deploy url="${tomcat_manager_url}"
            username="${tomcat.manager.username}"
            password="${tomcat.manager.password}"
            path="/${yawl.worklist.app.name}"
            war="../${output.dir}/${yawl.worklist.app.name}.war"
            update="true"/>

        <echo message="Deploying ${yawl.webService.app.name}"/>
        <deploy url="${tomcat_manager_url}"
            username="${tomcat.manager.username}"
            password="${tomcat.manager.password}"
            path="/${yawl.webService.app.name}"
            war="../${output.dir}/${yawl.webService.app.name}.war"
            update="true"/>

        <echo message="Deploying ${yawl.smsService.app.name}"/>
        <deploy url="${tomcat_manager_url}"
            username="${tomcat.manager.username}"
            password="${tomcat.manager.password}"
            path="/${yawl.smsService.app.name}"
            war="../${output.dir}/${yawl.smsService.app.name}.war"
            update="true"/>

        <echo message="Deploying ${yawl.worklet.app.name}"/>
        <deploy url="${tomcat_manager_url}"
            username="${tomcat.manager.username}"
            password="${tomcat.manager.password}"
            path="/${yawl.worklet.app.name}"
            war="../${output.dir}/${yawl.worklet.app.name}.war"
            update="true"/>

        <echo message="Deploying ${yawl.resource.app.name}"/>
        <deploy url="${tomcat_manager_url}"
            username="${tomcat.manager.username}"
            password="${tomcat.manager.password}"
            path="/${yawl.resource.app.name}"
            war="../${output.dir}/${yawl.resource.app.name}.war"
            update="true"/>

        <echo>Deployed OK</echo>
    </target>
    -->
    <!-- Target which applies the changes required to Tomcat's common libraries -->
    <!-- <target name="deploy_tomcat_common_libs"
            description="Update the Tomcat common libraries for XML parsers etc.">
    </target>
    -->

    <!-- Configure the custom Ant tasks for the Manager application -->
    <!-- <taskdef name="deploy" classname="org.apache.catalina.ant.DeployTask"/>
    <taskdef name="list" classname="org.apache.catalina.ant.ListTask"/>
    <taskdef name="reload" classname="org.apache.catalina.ant.ReloadTask"/>
    <taskdef name="resources" classname="org.apache.catalina.ant.ResourcesTask"/>
    <taskdef name="roles" classname="org.apache.catalina.ant.RolesTask"/>
    <taskdef name="start" classname="org.apache.catalina.ant.StartTask"/>
    <taskdef name="stop" classname="org.apache.catalina.ant.StopTask"/>
    <taskdef name="undeploy" classname="org.apache.catalina.ant.UndeployTask"/-->


    <!-- ==================== Reload Target =================================== -->
    <!--
      The "reload" target tells the specified Tomcat 5 installation to dynamically
      reload this web application, to reflect changes in the underlying classes or
      the "web.xml" deployment descriptor.
    - - >
    <target name="reload" depends="build" description="Reload application on servlet container">
        <reload url="${manager.url}"
            username="${manager.username}"
            password="${manager.password}"
            path="${yawl.eng.app.name}"/>
        <reload url="${manager.url}"
            username="${manager.username}"
            password="${manager.password}"
            path="${yawl.worklist.app.name}"/>
        <!- -reload url="${manager.url}"
            username="${manager.username}"
            password="${manager.password}"
            path="${yawl.webService.app.name}"/- ->
    </target>

    <!- -
    Clean build environment
    Deletes directories and intermediate files.
    -->
    <target name="removeDependancyInfo"
        description="cleans out the intellij records of previous compiles forcing the ide to recompile">
        <delete dir="${classes.dir}/.dependency-info"/>
    </target>


    <!--target name="launch" depends="reload" description="launch engine application">
        <java classname="org.yawlfoundation.yawl.engine.gui.YAdminGUI"
            fork="true"
            spawn="true">
            <jvmarg value="-Djava.rmi.server.codebase=file:/d:\YAWL\engine\classes/"/>
            <jvmarg value="-Djava.security.policy=./classes/java.policy2"/>
            <classpath refid="cp.standard"/>
            <classpath refid="cp.compile"/>
        </java>
    </target-->


</project>
